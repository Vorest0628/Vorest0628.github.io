import{y as l,z as o,A as s,K as c,O as r,D as M,P as T,a6 as F,r as v,c as S,w as H,j as A,aF as E,az as V,al as I,Q}from"./vendor-CeqXcVya.js";import{a as K,_ as O}from"./index-BH5EIy1g.js";import"./particles-D6-XlEtG.js";const U={searchAll:(_={})=>K.get("/search",{params:_})},j={name:"SearchView",setup(){const _=E(),n=V(),w=v(!1),e=v(null),u=v(""),h=v({blogs:[],documents:[],combined:[]}),d=v("all"),i=v(1),p=v(0),y=v(0),t=v({blogs:0,documents:0,total:0}),m=v(0),L=S(()=>h.value?d.value==="all"?h.value.combined||[]:d.value==="blog"?h.value.blogs||[]:h.value.documents||[]:[]),D=S(()=>{const a=[],C=Math.max(1,i.value-2),k=Math.min(y.value,i.value+2);for(let b=C;b<=k;b++)a.push(b);return a}),f=async(a,C=1)=>{var b;if(!a)return;w.value=!0,e.value=null;const k=Date.now();try{const g={q:a,page:C,pageSize:10};d.value!=="all"&&(g.type=d.value);const P=await U.searchAll(g);h.value=P.data||{blogs:[],documents:[],combined:[]},p.value=P.total||0,y.value=P.totalPages||0,i.value=P.page||1,t.value=P.resultCounts||{blogs:0,documents:0,total:0},m.value=((Date.now()-k)/1e3).toFixed(2)}catch(g){console.error("搜索失败:",g),g.code==="ECONNREFUSED"||g.message.includes("Network Error")?e.value="无法连接到服务器，请确保后端服务正在运行":((b=g.response)==null?void 0:b.status)===404?e.value="搜索接口不存在，请检查API配置":e.value=`搜索失败：${g.message||"请稍后再试"}`}finally{w.value=!1}},q=a=>{d.value=a,i.value=1,z(),f(u.value,1)},x=a=>{a<1||a>y.value||(i.value=a,z(),f(u.value,a))},z=()=>{const a={q:u.value,page:i.value};d.value!=="all"&&(a.type=d.value),n.replace({query:a})},R=()=>{f(u.value,i.value)},B=a=>a?new Date(a).toLocaleDateString("zh-CN"):"",N=a=>{if(!a)return"";const C=["B","KB","MB","GB"],k=Math.floor(Math.log(a)/Math.log(1024));return Math.round(a/Math.pow(1024,k)*100)/100+" "+C[k]};return H(()=>_.query,a=>{u.value=a.q||"",i.value=parseInt(a.page)||1,d.value=a.type||"all",u.value&&f(u.value,i.value)},{immediate:!0}),A(()=>{u.value=_.query.q||"",i.value=parseInt(_.query.page)||1,d.value=_.query.type||"all",u.value&&f(u.value,i.value)}),{loading:w,error:e,searchQuery:u,searchResults:h,activeFilter:d,currentPage:i,total:p,totalPages:y,resultCounts:t,searchTime:m,displayResults:L,visiblePages:D,search:f,setFilter:q,goToPage:x,retry:R,formatDate:B,formatFileSize:N,window}}},G={class:"search-view"},J={class:"search-header"},W={class:"search-info"},X={key:0},Y={key:1},Z={key:2,class:"result-stats"},$={class:"search-filters"},ee={key:0,class:"loading"},te={key:1,class:"error-message"},se={key:2,class:"search-results"},ae={key:0,class:"no-results"},le={key:1,class:"results-list"},oe={class:"result-header"},ne={class:"result-icon"},re={class:"result-type"},ie={key:0,class:"file-type"},ce={class:"result-title"},ue={class:"result-url"},de={class:"result-content"},ve=["innerHTML"],ge=["innerHTML"],_e={class:"result-meta"},he={class:"result-date"},ye={key:0,class:"result-category"},me={key:1,class:"download-count"},fe={key:2,class:"file-size"},ke={key:0,class:"result-tags"},be={key:0,class:"more-tags"},pe={key:2,class:"pagination"},Ce=["disabled"],Pe={class:"page-numbers"},we=["onClick"],Me=["disabled"];function Te(_,n,w,e,u,h){var i,p,y;const d=I("router-link");return o(),l("div",G,[s("div",J,[s("div",W,[e.searchQuery?(o(),l("h1",X,' "'+r(e.searchQuery)+'" 的搜索结果 ',1)):(o(),l("h1",Y,"搜索结果")),e.searchQuery&&!e.loading?(o(),l("div",Z," 找到约 "+r(e.total)+" 个结果 ("+r(e.searchTime)+"秒) ",1)):c("",!0)]),s("div",$,[s("button",{class:M(["filter-btn",{active:e.activeFilter==="all"}]),onClick:n[0]||(n[0]=t=>e.setFilter("all"))}," 全部 ("+r(((i=e.resultCounts)==null?void 0:i.total)||0)+") ",3),s("button",{class:M(["filter-btn",{active:e.activeFilter==="blog"}]),onClick:n[1]||(n[1]=t=>e.setFilter("blog"))}," 📝 博客 ("+r(((p=e.resultCounts)==null?void 0:p.blogs)||0)+") ",3),s("button",{class:M(["filter-btn",{active:e.activeFilter==="document"}]),onClick:n[2]||(n[2]=t=>e.setFilter("document"))}," 📄 文档 ("+r(((y=e.resultCounts)==null?void 0:y.documents)||0)+") ",3)])]),e.loading?(o(),l("div",ee,n[6]||(n[6]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"正在搜索...",-1)]))):c("",!0),e.error?(o(),l("div",te,[n[7]||(n[7]=s("div",{class:"error-icon"},"❌",-1)),s("p",null,r(e.error),1),s("button",{onClick:n[3]||(n[3]=(...t)=>e.retry&&e.retry(...t)),class:"retry-btn"},"重试")])):c("",!0),!e.loading&&!e.error?(o(),l("div",se,[e.displayResults.length===0&&e.searchQuery&&!e.loading?(o(),l("div",ae,n[8]||(n[8]=[s("div",{class:"no-results-icon"},"🔍",-1),s("h3",null,"未找到相关结果",-1),s("p",null,"尝试使用不同的关键词或检查拼写",-1),s("div",{class:"search-suggestions"},[s("h4",null,"搜索建议："),s("ul",null,[s("li",null,"确保所有单词拼写正确"),s("li",null,"尝试使用不同的关键词"),s("li",null,"尝试更一般的关键词"),s("li",null,"使用较少的关键词")])],-1)]))):(o(),l("div",le,[(o(!0),l(T,null,F(e.displayResults,t=>(o(),l("div",{key:`${t.type}-${t.id}`,class:"search-result-item"},[s("div",oe,[s("span",ne,r(t.icon),1),s("span",re,r(t.typeLabel),1),t.fileType?(o(),l("span",ie,r(t.fileType),1)):c("",!0)]),s("h3",ce,[Q(d,{to:t.url,innerHTML:t.title},null,8,["to","innerHTML"])]),s("div",ue,r(`${e.window.location.origin}${t.url}`),1),s("div",de,[t.excerpt?(o(),l("p",{key:0,innerHTML:t.excerpt,class:"result-excerpt"},null,8,ve)):c("",!0),t.snippet?(o(),l("p",{key:1,innerHTML:t.snippet,class:"result-snippet"},null,8,ge)):c("",!0)]),s("div",_e,[s("span",he,r(e.formatDate(t.date)),1),t.category?(o(),l("span",ye,r(t.category),1)):c("",!0),t.downloadCount?(o(),l("span",me," 下载: "+r(t.downloadCount),1)):c("",!0),t.fileSize?(o(),l("span",fe," 大小: "+r(e.formatFileSize(t.fileSize)),1)):c("",!0)]),t.tags&&t.tags.length?(o(),l("div",ke,[(o(!0),l(T,null,F(t.tags.slice(0,3),m=>(o(),l("span",{key:m,class:"tag"},r(m),1))),128)),t.tags.length>3?(o(),l("span",be," +"+r(t.tags.length-3),1)):c("",!0)])):c("",!0)]))),128))])),e.totalPages>1?(o(),l("div",pe,[s("button",{onClick:n[4]||(n[4]=t=>e.goToPage(e.currentPage-1)),disabled:e.currentPage===1,class:"page-btn"}," 上一页 ",8,Ce),s("div",Pe,[(o(!0),l(T,null,F(e.visiblePages,t=>(o(),l("button",{key:t,onClick:m=>e.goToPage(t),class:M(["page-number",{active:t===e.currentPage}])},r(t),11,we))),128))]),s("button",{onClick:n[5]||(n[5]=t=>e.goToPage(e.currentPage+1)),disabled:e.currentPage===e.totalPages,class:"page-btn"}," 下一页 ",8,Me)])):c("",!0)])):c("",!0)])}const Le=O(j,[["render",Te],["__scopeId","data-v-2ef509ad"]]);export{Le as default};
