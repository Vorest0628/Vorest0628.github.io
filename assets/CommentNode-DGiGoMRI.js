import{r as e,c as t,j as a,al as n,y as o,z as i,A as m,K as s,O as r,D as l,J as d,aj as c,ae as u,P as h,a6 as p,H as v,C as g}from"./vue-core-BYuX5Vli.js";import{b,_ as y,u as f}from"./index-B6AuLqK3.js";import{b as k,i as w,c as C,d as P,e as W,g as x}from"./utils-DA1bHc0c.js";const M={getComments:e=>b.get("/comments",{params:e}),getCommentById:e=>b.get(`/comments/${e}`),createComment:e=>b.post("/comments",e),updateComment:(e,t)=>b.put(`/comments/${e}`,t),deleteComment:e=>b.delete(`/comments/${e}`),replyComment:(e,t)=>b.post(`/comments/${e}/reply`,t),likeComment:e=>b.post(`/comments/${e}/like`),unlikeComment:e=>b.delete(`/comments/${e}/like`),checkLikeStatus:e=>b.get(`/comments/${e}/like-status`),reportComment:(e,t)=>b.post(`/comments/${e}/report`,t),getTargetComments:(e,t,a={})=>b.get(`/comments/${e}/${t}`,{params:a}),getPopularComments:(e={})=>b.get("/comments/popular",{params:e}),getLatestComments:(e={})=>b.get("/comments/latest",{params:e}),getMyComments:(e={})=>b.get("/comments/my",{params:e}),reviewComment:(e,t)=>b.post(`/comments/${e}/review`,t),getStats:(e={})=>b.get("/comments/stats",{params:e}),searchComments:(e,t={})=>b.get("/comments/search",{params:{keyword:e,...t}}),updateCommentVisibility:(e,t)=>b.put(`/comments/${e}`,{isPublic:t})},S={lessThanXSeconds:{one:"不到 1 秒",other:"不到 {{count}} 秒"},xSeconds:{one:"1 秒",other:"{{count}} 秒"},halfAMinute:"半分钟",lessThanXMinutes:{one:"不到 1 分钟",other:"不到 {{count}} 分钟"},xMinutes:{one:"1 分钟",other:"{{count}} 分钟"},xHours:{one:"1 小时",other:"{{count}} 小时"},aboutXHours:{one:"大约 1 小时",other:"大约 {{count}} 小时"},xDays:{one:"1 天",other:"{{count}} 天"},aboutXWeeks:{one:"大约 1 个星期",other:"大约 {{count}} 个星期"},xWeeks:{one:"1 个星期",other:"{{count}} 个星期"},aboutXMonths:{one:"大约 1 个月",other:"大约 {{count}} 个月"},xMonths:{one:"1 个月",other:"{{count}} 个月"},aboutXYears:{one:"大约 1 年",other:"大约 {{count}} 年"},xYears:{one:"1 年",other:"{{count}} 年"},overXYears:{one:"超过 1 年",other:"超过 {{count}} 年"},almostXYears:{one:"将近 1 年",other:"将近 {{count}} 年"}},$={date:k({formats:{full:"y'年'M'月'd'日' EEEE",long:"y'年'M'月'd'日'",medium:"yyyy-MM-dd",short:"yy-MM-dd"},defaultWidth:"full"}),time:k({formats:{full:"zzzz a h:mm:ss",long:"z a h:mm:ss",medium:"a h:mm:ss",short:"a h:mm"},defaultWidth:"full"}),dateTime:k({formats:{full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},defaultWidth:"full"})};function _(e,t,a){const n="eeee p";return w(e,t,a)?n:e.getTime()>t.getTime()?"'下个'"+n:"'上个'"+n}const z={lastWeek:_,yesterday:"'昨天' p",today:"'今天' p",tomorrow:"'明天' p",nextWeek:_,other:"PP p"},A={code:"zh-CN",formatDistance:(e,t,a)=>{let n;const o=S[e];return n="string"==typeof o?o:1===t?o.one:o.other.replace("{{count}}",String(t)),(null==a?void 0:a.addSuffix)?a.comparison&&a.comparison>0?n+"内":n+"前":n},formatLong:$,formatRelative:(e,t,a,n)=>{const o=z[e];return"function"==typeof o?o(t,a,n):o},localize:{ordinalNumber:(e,t)=>{const a=Number(e);switch(null==t?void 0:t.unit){case"date":return a.toString()+"日";case"hour":return a.toString()+"时";case"minute":return a.toString()+"分";case"second":return a.toString()+"秒";default:return"第 "+a.toString()}},era:C({values:{narrow:["前","公元"],abbreviated:["前","公元"],wide:["公元前","公元"]},defaultWidth:"wide"}),quarter:C({values:{narrow:["1","2","3","4"],abbreviated:["第一季","第二季","第三季","第四季"],wide:["第一季度","第二季度","第三季度","第四季度"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:C({values:{narrow:["一","二","三","四","五","六","七","八","九","十","十一","十二"],abbreviated:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],wide:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},defaultWidth:"wide"}),day:C({values:{narrow:["日","一","二","三","四","五","六"],short:["日","一","二","三","四","五","六"],abbreviated:["周日","周一","周二","周三","周四","周五","周六"],wide:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]},defaultWidth:"wide"}),dayPeriod:C({values:{narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},defaultWidth:"wide",formattingValues:{narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:W({matchPattern:/^(第\s*)?\d+(日|时|分|秒)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)}),era:P({matchPatterns:{narrow:/^(前)/i,abbreviated:/^(前)/i,wide:/^(公元前|公元)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^(前)/i,/^(公元)/i]},defaultParseWidth:"any"}),quarter:P({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^第[一二三四]刻/i,wide:/^第[一二三四]刻钟/i},defaultMatchWidth:"wide",parsePatterns:{any:[/(1|一)/i,/(2|二)/i,/(3|三)/i,/(4|四)/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:P({matchPatterns:{narrow:/^(一|二|三|四|五|六|七|八|九|十[二一])/i,abbreviated:/^(一|二|三|四|五|六|七|八|九|十[二一]|\d|1[12])月/i,wide:/^(一|二|三|四|五|六|七|八|九|十[二一])月/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^一/i,/^二/i,/^三/i,/^四/i,/^五/i,/^六/i,/^七/i,/^八/i,/^九/i,/^十(?!(一|二))/i,/^十一/i,/^十二/i],any:[/^一|1/i,/^二|2/i,/^三|3/i,/^四|4/i,/^五|5/i,/^六|6/i,/^七|7/i,/^八|8/i,/^九|9/i,/^十(?!(一|二))|10/i,/^十一|11/i,/^十二|12/i]},defaultParseWidth:"any"}),day:P({matchPatterns:{narrow:/^[一二三四五六日]/i,short:/^[一二三四五六日]/i,abbreviated:/^周[一二三四五六日]/i,wide:/^星期[一二三四五六日]/i},defaultMatchWidth:"wide",parsePatterns:{any:[/日/i,/一/i,/二/i,/三/i,/四/i,/五/i,/六/i]},defaultParseWidth:"any"}),dayPeriod:P({matchPatterns:{any:/^(上午?|下午?|午夜|[中正]午|早上?|下午|晚上?|凌晨|)/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^上午?/i,pm:/^下午?/i,midnight:/^午夜/i,noon:/^[中正]午/i,morning:/^早上/i,afternoon:/^下午/i,evening:/^晚上?/i,night:/^凌晨/i}},defaultParseWidth:"any"})},options:{weekStartsOn:1,firstWeekContainsDate:4}},T={class:"comment-item"},X={class:"comment-content"},N={class:"comment-header"},j={class:"comment-author"},D={class:"comment-time"},L={key:0,class:"private-badge"},I={class:"comment-text"},V={class:"comment-actions"},E={key:0,class:"reply-form"},Y={class:"reply-options"},q={class:"checkbox-label"},H=["disabled"],O={key:0,class:"comment-replies"},U=y({__name:"CommentNode",props:{comment:{type:Object,required:!0},depth:{type:Number,default:0}},emits:["comment-deleted","comment-added"],setup(b,{emit:y}){const k=b,w=y,C=f(),P=e(!1),W=e(""),S=e(!0),$=e(!1),_=e(!1),z=t(()=>k.comment.createdAt?x(new Date(k.comment.createdAt),{addSuffix:!0,locale:A}):""),U=t(()=>{var e,t,a,n;return!!C.isAuthenticated&&("admin"===(null==(e=C.user)?void 0:e.role)||(null==(t=C.user)?void 0:t.id)===((null==(a=k.comment.author)?void 0:a.id)||(null==(n=k.comment.author)?void 0:n._id)))}),B=t(()=>{var e,t,a,n;return!!C.isAuthenticated&&("admin"===(null==(e=C.user)?void 0:e.role)||(null==(t=C.user)?void 0:t.id)===((null==(a=k.comment.author)?void 0:a.id)||(null==(n=k.comment.author)?void 0:n._id)))}),F=async()=>{if(confirm("确定要删除这条评论吗？其所有回复也将被一并删除。"))try{const e=k.comment.id||k.comment._id;await M.deleteComment(e),w("comment-deleted",e),alert("评论已删除")}catch(e){alert("删除失败，请稍后重试。")}},J=async()=>{if(W.value.trim()){$.value=!0;try{const e={content:W.value,targetId:k.comment.targetId,targetType:k.comment.targetType,parentComment:k.comment.id||k.comment._id,isPublic:S.value},t=await M.createComment(e);t.success&&(w("comment-added",t.data),W.value="",S.value=!0,P.value=!1,alert("回复成功"))}catch(e){alert("回复失败，请稍后重试。")}finally{$.value=!1}}else alert("回复内容不能为空")},K=async()=>{var e,t;if(C.isAuthenticated)try{_.value?(await M.unlikeComment(k.comment.id||k.comment._id),k.comment.likeCount=Math.max(0,(k.comment.likeCount||0)-1)):(await M.likeComment(k.comment.id||k.comment._id),k.comment.likeCount=(k.comment.likeCount||0)+1),_.value=!_.value}catch(a){alert((null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"操作失败")}else alert("请先登录")},R=async()=>{try{const e=!k.comment.isPublic;await M.updateCommentVisibility(k.comment.id||k.comment._id,e),k.comment.isPublic=e,alert("评论已"+(e?"设为公开":"设为私有"))}catch(e){alert("操作失败")}};return a(()=>{(async()=>{try{const e=k.comment.id||k.comment._id,t=await M.checkLikeStatus(e);t.success&&(_.value=t.data.isLiked)}catch(e){}})()}),(e,t)=>{var a;const y=n("CommentNode",!0);return i(),o("div",{class:l(["comment-node",{"top-level-comment":0===b.depth}]),style:g({marginLeft:20*b.depth+"px"})},[m("div",T,[m("div",X,[m("div",N,[m("span",j,r((null==(a=b.comment.author)?void 0:a.username)||"匿名用户"),1),m("span",D,r(z.value),1),b.comment.isPublic?s("",!0):(i(),o("span",L,"私有"))]),m("div",I,r(b.comment.content),1),m("div",V,[m("button",{onClick:K,class:l(["action-btn like-btn",{liked:_.value}])},r(_.value?"❤️":"🤍")+" "+r(b.comment.likeCount||0),3),m("button",{onClick:t[0]||(t[0]=e=>P.value=!P.value),class:"action-btn"},"回复"),B.value?(i(),o("button",{key:0,onClick:R,class:l(["action-btn visibility-btn",{private:!b.comment.isPublic}])},r(b.comment.isPublic?"设为私有":"设为公开"),3)):s("",!0),U.value?(i(),o("button",{key:1,onClick:F,class:"action-btn delete-btn"}," 删除 ")):s("",!0)]),P.value?(i(),o("div",E,[d(m("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>W.value=e),placeholder:"输入你的回复...",rows:"3"},null,512),[[c,W.value]]),m("div",Y,[m("label",q,[d(m("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>S.value=e),type:"checkbox",class:"checkbox-input"},null,512),[[u,S.value]]),t[6]||(t[6]=m("span",{class:"checkbox-text"},"公开回复",-1))])]),m("button",{onClick:J,disabled:$.value},"提交回复",8,H),m("button",{onClick:t[3]||(t[3]=e=>P.value=!1),class:"cancel-btn"},"取消")])):s("",!0)])]),b.comment.replies&&b.comment.replies.length>0?(i(),o("div",O,[(i(!0),o(h,null,p(b.comment.replies,a=>(i(),v(y,{key:a.id||a._id,comment:a,depth:b.depth+1,onCommentDeleted:t[4]||(t[4]=t=>e.$emit("comment-deleted",t)),onCommentAdded:t[5]||(t[5]=t=>e.$emit("comment-added",t))},null,8,["comment","depth"]))),128))])):s("",!0)],6)}}},[["__scopeId","data-v-5277ada2"]]);export{U as C,M as c};
