import{r as e,c as a,j as s,y as l,z as r,A as o,K as n,V as u,J as t,aj as d,O as i}from"./vue-core-BYuX5Vli.js";import{_ as c,u as v}from"./index-B6AuLqK3.js";import{u as m}from"./UserPanel-6kLqNBdo.js";import"./element-ui-drMXFw0_.js";import"./utils-DA1bHc0c.js";const w={class:"user-account-settings"},p={class:"settings-sections"},P={class:"setting-section"},f={class:"setting-content"},b={class:"form-row"},y={class:"form-group"},g={class:"form-group"},h=["disabled"],U={class:"setting-section"},V={class:"setting-content"},k={class:"form-group"},j={class:"form-group"},q={class:"form-group"},C={key:0,class:"error"},_={class:"form-actions"},S=["disabled"],x={class:"modal-body"},A={class:"form-group"},E={class:"form-group"},z={class:"form-group"},I={key:0,class:"error"},J={class:"form-actions"},K=["disabled"],O=c({__name:"UserAccountSettings",setup(c){const O=v(),B=e({username:"",email:""}),D=e({currentPassword:"",newPassword:"",confirmPassword:""}),F=e({email:"",newPassword:"",confirmPassword:""}),G=e(!1),H=e(!1),L=e(!1),M=e(!1),N=a(()=>D.value.currentPassword&&D.value.newPassword&&D.value.confirmPassword&&D.value.newPassword===D.value.confirmPassword&&D.value.newPassword.length>=6),Q=a(()=>F.value.email&&F.value.newPassword&&F.value.confirmPassword&&F.value.newPassword===F.value.confirmPassword&&F.value.newPassword.length>=6),R=async()=>{var e,a;G.value=!0;try{const{username:e,...a}=B.value,s=await m.updateProfile(a);if(!s.success)throw new Error(s.message||"更新失败");alert("个人资料更新成功！"),await O.initAuth()}catch(s){alert("更新失败："+((null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||s.message||"请重试"))}finally{G.value=!1}},T=async()=>{var e,a;H.value=!0;try{const{confirmPassword:e,...a}=D.value,s=await m.changePassword(a);if(!s.success)throw new Error(s.message||"修改失败");alert("密码修改成功！"),D.value={currentPassword:"",newPassword:"",confirmPassword:""}}catch(s){const l=(null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||s.message||"修改密码失败，请重试";alert("修改密码失败："+l)}finally{H.value=!1}},W=async()=>{var e,a;M.value=!0;try{const e=await m.resetPassword(F.value);if(!e.success)throw new Error(e.message||"重置失败");alert("密码重置成功！请检查您的邮箱，并使用新密码登录。"),F.value={email:"",newPassword:"",confirmPassword:""}}catch(s){const l=(null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||s.message||"重置密码失败，请重试";alert("重置密码失败："+l)}finally{M.value=!1}},X=()=>{L.value=!1};return s(()=>{(async()=>{try{const e=O.user;e&&(B.value={username:e.username||"",email:e.email||""})}catch(e){}})()}),(e,a)=>(r(),l("div",w,[a[24]||(a[24]=o("div",{class:"settings-header"},[o("h2",null,"账户设置"),o("p",null,"管理您的个人资料和账户安全")],-1)),o("div",p,[o("div",P,[a[13]||(a[13]=o("h3",null,"个人资料",-1)),o("div",f,[o("form",{onSubmit:u(R,["prevent"])},[o("div",b,[o("div",y,[a[10]||(a[10]=o("label",null,"用户名",-1)),t(o("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>B.value.username=e),type:"text",readonly:"",class:"readonly"},null,512),[[d,B.value.username]]),a[11]||(a[11]=o("small",null,"用户名无法修改",-1))]),o("div",g,[a[12]||(a[12]=o("label",null,"邮箱",-1)),t(o("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>B.value.email=e),type:"email",required:""},null,512),[[d,B.value.email]])])]),o("button",{type:"submit",class:"save-btn",disabled:G.value},i(G.value?"保存中...":"保存资料"),9,h)],32)])]),o("div",U,[a[18]||(a[18]=o("h3",null,"密码安全",-1)),o("div",V,[o("form",{onSubmit:u(T,["prevent"])},[o("div",k,[a[14]||(a[14]=o("label",null,"当前密码",-1)),t(o("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>D.value.currentPassword=e),type:"password",required:""},null,512),[[d,D.value.currentPassword]])]),o("div",j,[a[15]||(a[15]=o("label",null,"新密码",-1)),t(o("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>D.value.newPassword=e),type:"password",required:"",minlength:"6"},null,512),[[d,D.value.newPassword]]),a[16]||(a[16]=o("small",null,"密码至少6位",-1))]),o("div",q,[a[17]||(a[17]=o("label",null,"确认新密码",-1)),t(o("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>D.value.confirmPassword=e),type:"password",required:""},null,512),[[d,D.value.confirmPassword]]),D.value.newPassword&&D.value.confirmPassword&&D.value.newPassword!==D.value.confirmPassword?(r(),l("small",C," 两次输入的密码不一致 ")):n("",!0)]),o("div",_,[o("button",{type:"submit",class:"save-btn",disabled:H.value||!N.value},i(H.value?"修改中...":"修改密码"),9,S),o("button",{type:"button",onClick:a[5]||(a[5]=e=>L.value=!0),class:"forgot-btn"}," 忘记密码？ ")])],32)])]),L.value?(r(),l("div",{key:0,class:"modal-overlay",onClick:X},[o("div",{class:"modal-content",onClick:a[9]||(a[9]=u(()=>{},["stop"]))},[o("div",{class:"modal-header"},[a[19]||(a[19]=o("h3",null,"重置密码",-1)),o("button",{onClick:X,class:"close-btn"},"✕")]),o("div",x,[o("form",{onSubmit:u(W,["prevent"])},[o("div",A,[a[20]||(a[20]=o("label",null,"邮箱地址",-1)),t(o("input",{"onUpdate:modelValue":a[6]||(a[6]=e=>F.value.email=e),type:"email",required:"",placeholder:"输入您的邮箱地址"},null,512),[[d,F.value.email]])]),o("div",E,[a[21]||(a[21]=o("label",null,"新密码",-1)),t(o("input",{"onUpdate:modelValue":a[7]||(a[7]=e=>F.value.newPassword=e),type:"password",required:"",minlength:"6"},null,512),[[d,F.value.newPassword]]),a[22]||(a[22]=o("small",null,"密码至少6位",-1))]),o("div",z,[a[23]||(a[23]=o("label",null,"确认新密码",-1)),t(o("input",{"onUpdate:modelValue":a[8]||(a[8]=e=>F.value.confirmPassword=e),type:"password",required:""},null,512),[[d,F.value.confirmPassword]]),F.value.newPassword&&F.value.confirmPassword&&F.value.newPassword!==F.value.confirmPassword?(r(),l("small",I," 两次输入的密码不一致 ")):n("",!0)]),o("div",J,[o("button",{type:"button",onClick:X,class:"cancel-btn"},"取消"),o("button",{type:"submit",class:"save-btn",disabled:M.value||!Q.value},i(M.value?"重置中...":"重置密码"),9,K)])],32)])])])):n("",!0)])]))}},[["__scopeId","data-v-b3d96e44"]]);export{O as default};
