import{r as d,c as _,j as D,y as c,z as f,A as e,K as y,V as P,J as r,aj as n,O as U}from"./vendor-CeqXcVya.js";import{_ as E,u as B}from"./index-BH5EIy1g.js";import{u as V}from"./UserPanel-l2sN8Ips.js";import"./particles-D6-XlEtG.js";const F={class:"user-account-settings"},L={class:"settings-sections"},R={class:"setting-section"},j={class:"setting-content"},N={class:"form-row"},h={class:"form-group"},z={class:"form-group"},I=["disabled"],J={class:"setting-section"},K={class:"setting-content"},O={class:"form-group"},T={class:"form-group"},$={class:"form-group"},G={key:0,class:"error"},H={class:"form-actions"},Q=["disabled"],W={class:"modal-body"},X={class:"form-group"},Y={class:"form-group"},Z={class:"form-group"},ss={key:0,class:"error"},es={class:"form-actions"},os=["disabled"],as={__name:"UserAccountSettings",setup(ls){const k=B(),i=d({username:"",email:""}),a=d({currentPassword:"",newPassword:"",confirmPassword:""}),l=d({email:"",newPassword:"",confirmPassword:""}),v=d(!1),w=d(!1),g=d(!1),p=d(!1),S=_(()=>a.value.currentPassword&&a.value.newPassword&&a.value.confirmPassword&&a.value.newPassword===a.value.confirmPassword&&a.value.newPassword.length>=6),q=_(()=>l.value.email&&l.value.newPassword&&l.value.confirmPassword&&l.value.newPassword===l.value.confirmPassword&&l.value.newPassword.length>=6),C=async()=>{try{const t=k.user;t&&(i.value={username:t.username||"",email:t.email||""})}catch(t){console.error("加载用户数据失败:",t)}},A=async()=>{var t,s;v.value=!0;try{const{username:o,...u}=i.value,m=await V.updateProfile(u);if(m.success)alert("个人资料更新成功！"),await k.initAuth();else throw new Error(m.message||"更新失败")}catch(o){console.error("更新资料失败:",o),alert("更新失败："+(((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.message)||o.message||"请重试"))}finally{v.value=!1}},x=async()=>{var t,s;w.value=!0;try{const{confirmPassword:o,...u}=a.value,m=await V.changePassword(u);if(m.success)alert("密码修改成功！"),a.value={currentPassword:"",newPassword:"",confirmPassword:""};else throw new Error(m.message||"修改失败")}catch(o){console.error("修改密码失败:",o);const u=((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.message)||o.message||"修改密码失败，请重试";alert("修改密码失败："+u)}finally{w.value=!1}},M=async()=>{var t,s;p.value=!0;try{const o=await V.resetPassword(l.value);if(o.success)alert("密码重置成功！请检查您的邮箱，并使用新密码登录。"),l.value={email:"",newPassword:"",confirmPassword:""};else throw new Error(o.message||"重置失败")}catch(o){console.error("重置密码失败:",o);const u=((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.message)||o.message||"重置密码失败，请重试";alert("重置密码失败："+u)}finally{p.value=!1}},b=()=>{g.value=!1};return D(()=>{C()}),(t,s)=>(f(),c("div",F,[s[24]||(s[24]=e("div",{class:"settings-header"},[e("h2",null,"账户设置"),e("p",null,"管理您的个人资料和账户安全")],-1)),e("div",L,[e("div",R,[s[13]||(s[13]=e("h3",null,"个人资料",-1)),e("div",j,[e("form",{onSubmit:P(A,["prevent"])},[e("div",N,[e("div",h,[s[10]||(s[10]=e("label",null,"用户名",-1)),r(e("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>i.value.username=o),type:"text",readonly:"",class:"readonly"},null,512),[[n,i.value.username]]),s[11]||(s[11]=e("small",null,"用户名无法修改",-1))]),e("div",z,[s[12]||(s[12]=e("label",null,"邮箱",-1)),r(e("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>i.value.email=o),type:"email",required:""},null,512),[[n,i.value.email]])])]),e("button",{type:"submit",class:"save-btn",disabled:v.value},U(v.value?"保存中...":"保存资料"),9,I)],32)])]),e("div",J,[s[18]||(s[18]=e("h3",null,"密码安全",-1)),e("div",K,[e("form",{onSubmit:P(x,["prevent"])},[e("div",O,[s[14]||(s[14]=e("label",null,"当前密码",-1)),r(e("input",{"onUpdate:modelValue":s[2]||(s[2]=o=>a.value.currentPassword=o),type:"password",required:""},null,512),[[n,a.value.currentPassword]])]),e("div",T,[s[15]||(s[15]=e("label",null,"新密码",-1)),r(e("input",{"onUpdate:modelValue":s[3]||(s[3]=o=>a.value.newPassword=o),type:"password",required:"",minlength:"6"},null,512),[[n,a.value.newPassword]]),s[16]||(s[16]=e("small",null,"密码至少6位",-1))]),e("div",$,[s[17]||(s[17]=e("label",null,"确认新密码",-1)),r(e("input",{"onUpdate:modelValue":s[4]||(s[4]=o=>a.value.confirmPassword=o),type:"password",required:""},null,512),[[n,a.value.confirmPassword]]),a.value.newPassword&&a.value.confirmPassword&&a.value.newPassword!==a.value.confirmPassword?(f(),c("small",G," 两次输入的密码不一致 ")):y("",!0)]),e("div",H,[e("button",{type:"submit",class:"save-btn",disabled:w.value||!S.value},U(w.value?"修改中...":"修改密码"),9,Q),e("button",{type:"button",onClick:s[5]||(s[5]=o=>g.value=!0),class:"forgot-btn"}," 忘记密码？ ")])],32)])]),g.value?(f(),c("div",{key:0,class:"modal-overlay",onClick:b},[e("div",{class:"modal-content",onClick:s[9]||(s[9]=P(()=>{},["stop"]))},[e("div",{class:"modal-header"},[s[19]||(s[19]=e("h3",null,"重置密码",-1)),e("button",{onClick:b,class:"close-btn"},"✕")]),e("div",W,[e("form",{onSubmit:P(M,["prevent"])},[e("div",X,[s[20]||(s[20]=e("label",null,"邮箱地址",-1)),r(e("input",{"onUpdate:modelValue":s[6]||(s[6]=o=>l.value.email=o),type:"email",required:"",placeholder:"输入您的邮箱地址"},null,512),[[n,l.value.email]])]),e("div",Y,[s[21]||(s[21]=e("label",null,"新密码",-1)),r(e("input",{"onUpdate:modelValue":s[7]||(s[7]=o=>l.value.newPassword=o),type:"password",required:"",minlength:"6"},null,512),[[n,l.value.newPassword]]),s[22]||(s[22]=e("small",null,"密码至少6位",-1))]),e("div",Z,[s[23]||(s[23]=e("label",null,"确认新密码",-1)),r(e("input",{"onUpdate:modelValue":s[8]||(s[8]=o=>l.value.confirmPassword=o),type:"password",required:""},null,512),[[n,l.value.confirmPassword]]),l.value.newPassword&&l.value.confirmPassword&&l.value.newPassword!==l.value.confirmPassword?(f(),c("small",ss," 两次输入的密码不一致 ")):y("",!0)]),e("div",es,[e("button",{type:"button",onClick:b,class:"cancel-btn"},"取消"),e("button",{type:"submit",class:"save-btn",disabled:p.value||!q.value},U(p.value?"重置中...":"重置密码"),9,os)])],32)])])])):y("",!0)])]))}},ds=E(as,[["__scopeId","data-v-1f344430"]]);export{ds as default};
