import{r as e,c as t,j as a,al as n,y as o,z as i,A as m,K as s,O as r,D as l,J as d,aj as c,ae as u,P as h,a6 as p,H as v,C as g}from"./vue-core-BH5VTiN9.js";import{b,_ as y,u as f}from"./index-BPjNz-Ae.js";import{b as k,i as w,c as C,d as P,e as W,g as x}from"./utils-DA1bHc0c.js";const M={getComments:e=>b.get("/comments",{params:e}),getCommentById:e=>b.get(`/comments/${e}`),createComment:e=>b.post("/comments",e),updateComment:(e,t)=>b.put(`/comments/${e}`,t),deleteComment:e=>b.delete(`/comments/${e}`),replyComment:(e,t)=>b.post(`/comments/${e}/reply`,t),likeComment:e=>b.post(`/comments/${e}/like`),unlikeComment:e=>b.delete(`/comments/${e}/like`),checkLikeStatus:e=>b.get(`/comments/${e}/like-status`),reportComment:(e,t)=>b.post(`/comments/${e}/report`,t),getTargetComments:(e,t,a={})=>b.get(`/comments/${e}/${t}`,{params:a}),getPopularComments:(e={})=>b.get("/comments/popular",{params:e}),getLatestComments:(e={})=>b.get("/comments/latest",{params:e}),getMyComments:(e={})=>b.get("/comments/my",{params:e}),reviewComment:(e,t)=>b.post(`/comments/${e}/review`,t),getStats:(e={})=>b.get("/comments/stats",{params:e}),searchComments:(e,t={})=>b.get("/comments/search",{params:{keyword:e,...t}}),updateCommentVisibility:(e,t)=>b.put(`/comments/${e}`,{isPublic:t})},S={lessThanXSeconds:{one:"ä¸åˆ° 1 ç§’",other:"ä¸åˆ° {{count}} ç§’"},xSeconds:{one:"1 ç§’",other:"{{count}} ç§’"},halfAMinute:"åŠåˆ†é’Ÿ",lessThanXMinutes:{one:"ä¸åˆ° 1 åˆ†é’Ÿ",other:"ä¸åˆ° {{count}} åˆ†é’Ÿ"},xMinutes:{one:"1 åˆ†é’Ÿ",other:"{{count}} åˆ†é’Ÿ"},xHours:{one:"1 å°æ—¶",other:"{{count}} å°æ—¶"},aboutXHours:{one:"å¤§çº¦ 1 å°æ—¶",other:"å¤§çº¦ {{count}} å°æ—¶"},xDays:{one:"1 å¤©",other:"{{count}} å¤©"},aboutXWeeks:{one:"å¤§çº¦ 1 ä¸ªæ˜ŸæœŸ",other:"å¤§çº¦ {{count}} ä¸ªæ˜ŸæœŸ"},xWeeks:{one:"1 ä¸ªæ˜ŸæœŸ",other:"{{count}} ä¸ªæ˜ŸæœŸ"},aboutXMonths:{one:"å¤§çº¦ 1 ä¸ªæœˆ",other:"å¤§çº¦ {{count}} ä¸ªæœˆ"},xMonths:{one:"1 ä¸ªæœˆ",other:"{{count}} ä¸ªæœˆ"},aboutXYears:{one:"å¤§çº¦ 1 å¹´",other:"å¤§çº¦ {{count}} å¹´"},xYears:{one:"1 å¹´",other:"{{count}} å¹´"},overXYears:{one:"è¶…è¿‡ 1 å¹´",other:"è¶…è¿‡ {{count}} å¹´"},almostXYears:{one:"å°†è¿‘ 1 å¹´",other:"å°†è¿‘ {{count}} å¹´"}},$={date:k({formats:{full:"y'å¹´'M'æœˆ'd'æ—¥' EEEE",long:"y'å¹´'M'æœˆ'd'æ—¥'",medium:"yyyy-MM-dd",short:"yy-MM-dd"},defaultWidth:"full"}),time:k({formats:{full:"zzzz a h:mm:ss",long:"z a h:mm:ss",medium:"a h:mm:ss",short:"a h:mm"},defaultWidth:"full"}),dateTime:k({formats:{full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},defaultWidth:"full"})};function _(e,t,a){const n="eeee p";return w(e,t,a)?n:e.getTime()>t.getTime()?"'ä¸‹ä¸ª'"+n:"'ä¸Šä¸ª'"+n}const z={lastWeek:_,yesterday:"'æ˜¨å¤©' p",today:"'ä»Šå¤©' p",tomorrow:"'æ˜Žå¤©' p",nextWeek:_,other:"PP p"},A={code:"zh-CN",formatDistance:(e,t,a)=>{let n;const o=S[e];return n="string"==typeof o?o:1===t?o.one:o.other.replace("{{count}}",String(t)),(null==a?void 0:a.addSuffix)?a.comparison&&a.comparison>0?n+"å†…":n+"å‰":n},formatLong:$,formatRelative:(e,t,a,n)=>{const o=z[e];return"function"==typeof o?o(t,a,n):o},localize:{ordinalNumber:(e,t)=>{const a=Number(e);switch(null==t?void 0:t.unit){case"date":return a.toString()+"æ—¥";case"hour":return a.toString()+"æ—¶";case"minute":return a.toString()+"åˆ†";case"second":return a.toString()+"ç§’";default:return"ç¬¬ "+a.toString()}},era:C({values:{narrow:["å‰","å…¬å…ƒ"],abbreviated:["å‰","å…¬å…ƒ"],wide:["å…¬å…ƒå‰","å…¬å…ƒ"]},defaultWidth:"wide"}),quarter:C({values:{narrow:["1","2","3","4"],abbreviated:["ç¬¬ä¸€å­£","ç¬¬äºŒå­£","ç¬¬ä¸‰å­£","ç¬¬å››å­£"],wide:["ç¬¬ä¸€å­£åº¦","ç¬¬äºŒå­£åº¦","ç¬¬ä¸‰å­£åº¦","ç¬¬å››å­£åº¦"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:C({values:{narrow:["ä¸€","äºŒ","ä¸‰","å››","äº”","å…­","ä¸ƒ","å…«","ä¹","å","åä¸€","åäºŒ"],abbreviated:["1æœˆ","2æœˆ","3æœˆ","4æœˆ","5æœˆ","6æœˆ","7æœˆ","8æœˆ","9æœˆ","10æœˆ","11æœˆ","12æœˆ"],wide:["ä¸€æœˆ","äºŒæœˆ","ä¸‰æœˆ","å››æœˆ","äº”æœˆ","å…­æœˆ","ä¸ƒæœˆ","å…«æœˆ","ä¹æœˆ","åæœˆ","åä¸€æœˆ","åäºŒæœˆ"]},defaultWidth:"wide"}),day:C({values:{narrow:["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],short:["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],abbreviated:["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"],wide:["æ˜ŸæœŸæ—¥","æ˜ŸæœŸä¸€","æ˜ŸæœŸäºŒ","æ˜ŸæœŸä¸‰","æ˜ŸæœŸå››","æ˜ŸæœŸäº”","æ˜ŸæœŸå…­"]},defaultWidth:"wide"}),dayPeriod:C({values:{narrow:{am:"ä¸Š",pm:"ä¸‹",midnight:"å‡Œæ™¨",noon:"åˆ",morning:"æ—©",afternoon:"ä¸‹åˆ",evening:"æ™š",night:"å¤œ"},abbreviated:{am:"ä¸Šåˆ",pm:"ä¸‹åˆ",midnight:"å‡Œæ™¨",noon:"ä¸­åˆ",morning:"æ—©æ™¨",afternoon:"ä¸­åˆ",evening:"æ™šä¸Š",night:"å¤œé—´"},wide:{am:"ä¸Šåˆ",pm:"ä¸‹åˆ",midnight:"å‡Œæ™¨",noon:"ä¸­åˆ",morning:"æ—©æ™¨",afternoon:"ä¸­åˆ",evening:"æ™šä¸Š",night:"å¤œé—´"}},defaultWidth:"wide",formattingValues:{narrow:{am:"ä¸Š",pm:"ä¸‹",midnight:"å‡Œæ™¨",noon:"åˆ",morning:"æ—©",afternoon:"ä¸‹åˆ",evening:"æ™š",night:"å¤œ"},abbreviated:{am:"ä¸Šåˆ",pm:"ä¸‹åˆ",midnight:"å‡Œæ™¨",noon:"ä¸­åˆ",morning:"æ—©æ™¨",afternoon:"ä¸­åˆ",evening:"æ™šä¸Š",night:"å¤œé—´"},wide:{am:"ä¸Šåˆ",pm:"ä¸‹åˆ",midnight:"å‡Œæ™¨",noon:"ä¸­åˆ",morning:"æ—©æ™¨",afternoon:"ä¸­åˆ",evening:"æ™šä¸Š",night:"å¤œé—´"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:W({matchPattern:/^(ç¬¬\s*)?\d+(æ—¥|æ—¶|åˆ†|ç§’)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)}),era:P({matchPatterns:{narrow:/^(å‰)/i,abbreviated:/^(å‰)/i,wide:/^(å…¬å…ƒå‰|å…¬å…ƒ)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^(å‰)/i,/^(å…¬å…ƒ)/i]},defaultParseWidth:"any"}),quarter:P({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^ç¬¬[ä¸€äºŒä¸‰å››]åˆ»/i,wide:/^ç¬¬[ä¸€äºŒä¸‰å››]åˆ»é’Ÿ/i},defaultMatchWidth:"wide",parsePatterns:{any:[/(1|ä¸€)/i,/(2|äºŒ)/i,/(3|ä¸‰)/i,/(4|å››)/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:P({matchPatterns:{narrow:/^(ä¸€|äºŒ|ä¸‰|å››|äº”|å…­|ä¸ƒ|å…«|ä¹|å[äºŒä¸€])/i,abbreviated:/^(ä¸€|äºŒ|ä¸‰|å››|äº”|å…­|ä¸ƒ|å…«|ä¹|å[äºŒä¸€]|\d|1[12])æœˆ/i,wide:/^(ä¸€|äºŒ|ä¸‰|å››|äº”|å…­|ä¸ƒ|å…«|ä¹|å[äºŒä¸€])æœˆ/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^ä¸€/i,/^äºŒ/i,/^ä¸‰/i,/^å››/i,/^äº”/i,/^å…­/i,/^ä¸ƒ/i,/^å…«/i,/^ä¹/i,/^å(?!(ä¸€|äºŒ))/i,/^åä¸€/i,/^åäºŒ/i],any:[/^ä¸€|1/i,/^äºŒ|2/i,/^ä¸‰|3/i,/^å››|4/i,/^äº”|5/i,/^å…­|6/i,/^ä¸ƒ|7/i,/^å…«|8/i,/^ä¹|9/i,/^å(?!(ä¸€|äºŒ))|10/i,/^åä¸€|11/i,/^åäºŒ|12/i]},defaultParseWidth:"any"}),day:P({matchPatterns:{narrow:/^[ä¸€äºŒä¸‰å››äº”å…­æ—¥]/i,short:/^[ä¸€äºŒä¸‰å››äº”å…­æ—¥]/i,abbreviated:/^å‘¨[ä¸€äºŒä¸‰å››äº”å…­æ—¥]/i,wide:/^æ˜ŸæœŸ[ä¸€äºŒä¸‰å››äº”å…­æ—¥]/i},defaultMatchWidth:"wide",parsePatterns:{any:[/æ—¥/i,/ä¸€/i,/äºŒ/i,/ä¸‰/i,/å››/i,/äº”/i,/å…­/i]},defaultParseWidth:"any"}),dayPeriod:P({matchPatterns:{any:/^(ä¸Šåˆ?|ä¸‹åˆ?|åˆå¤œ|[ä¸­æ­£]åˆ|æ—©ä¸Š?|ä¸‹åˆ|æ™šä¸Š?|å‡Œæ™¨|)/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^ä¸Šåˆ?/i,pm:/^ä¸‹åˆ?/i,midnight:/^åˆå¤œ/i,noon:/^[ä¸­æ­£]åˆ/i,morning:/^æ—©ä¸Š/i,afternoon:/^ä¸‹åˆ/i,evening:/^æ™šä¸Š?/i,night:/^å‡Œæ™¨/i}},defaultParseWidth:"any"})},options:{weekStartsOn:1,firstWeekContainsDate:4}},T={class:"comment-item"},X={class:"comment-content"},N={class:"comment-header"},j={class:"comment-author"},D={class:"comment-time"},L={key:0,class:"private-badge"},I={class:"comment-text"},V={class:"comment-actions"},E={key:0,class:"reply-form"},Y={class:"reply-options"},q={class:"checkbox-label"},H=["disabled"],O={key:0,class:"comment-replies"},U=y({__name:"CommentNode",props:{comment:{type:Object,required:!0},depth:{type:Number,default:0}},emits:["comment-deleted","comment-added"],setup(b,{emit:y}){const k=b,w=y,C=f(),P=e(!1),W=e(""),S=e(!0),$=e(!1),_=e(!1),z=t(()=>k.comment.createdAt?x(new Date(k.comment.createdAt),{addSuffix:!0,locale:A}):""),U=t(()=>{var e,t,a,n;return!!C.isAuthenticated&&("admin"===(null==(e=C.user)?void 0:e.role)||(null==(t=C.user)?void 0:t.id)===((null==(a=k.comment.author)?void 0:a.id)||(null==(n=k.comment.author)?void 0:n._id)))}),B=t(()=>{var e,t,a,n;return!!C.isAuthenticated&&("admin"===(null==(e=C.user)?void 0:e.role)||(null==(t=C.user)?void 0:t.id)===((null==(a=k.comment.author)?void 0:a.id)||(null==(n=k.comment.author)?void 0:n._id)))}),F=async()=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿå…¶æ‰€æœ‰å›žå¤ä¹Ÿå°†è¢«ä¸€å¹¶åˆ é™¤ã€‚"))try{const e=k.comment.id||k.comment._id;await M.deleteComment(e),w("comment-deleted",e),alert("è¯„è®ºå·²åˆ é™¤")}catch(e){alert("åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•ã€‚")}},J=async()=>{if(W.value.trim()){$.value=!0;try{const e={content:W.value,targetId:k.comment.targetId,targetType:k.comment.targetType,parentComment:k.comment.id||k.comment._id,isPublic:S.value},t=await M.createComment(e);t.success&&(w("comment-added",t.data),W.value="",S.value=!0,P.value=!1,alert("å›žå¤æˆåŠŸ"))}catch(e){alert("å›žå¤å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•ã€‚")}finally{$.value=!1}}else alert("å›žå¤å†…å®¹ä¸èƒ½ä¸ºç©º")},K=async()=>{var e,t;if(C.isAuthenticated)try{_.value?(await M.unlikeComment(k.comment.id||k.comment._id),k.comment.likeCount=Math.max(0,(k.comment.likeCount||0)-1)):(await M.likeComment(k.comment.id||k.comment._id),k.comment.likeCount=(k.comment.likeCount||0)+1),_.value=!_.value}catch(a){alert((null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"æ“ä½œå¤±è´¥")}else alert("è¯·å…ˆç™»å½•")},R=async()=>{try{const e=!k.comment.isPublic;await M.updateCommentVisibility(k.comment.id||k.comment._id,e),k.comment.isPublic=e,alert("è¯„è®ºå·²"+(e?"è®¾ä¸ºå…¬å¼€":"è®¾ä¸ºç§æœ‰"))}catch(e){alert("æ“ä½œå¤±è´¥")}};return a(()=>{(async()=>{try{const e=k.comment.id||k.comment._id,t=await M.checkLikeStatus(e);t.success&&(_.value=t.data.isLiked)}catch(e){}})()}),(e,t)=>{var a;const y=n("CommentNode",!0);return i(),o("div",{class:l(["comment-node",{"top-level-comment":0===b.depth}]),style:g({marginLeft:20*b.depth+"px"})},[m("div",T,[m("div",X,[m("div",N,[m("span",j,r((null==(a=b.comment.author)?void 0:a.username)||"åŒ¿åç”¨æˆ·"),1),m("span",D,r(z.value),1),b.comment.isPublic?s("",!0):(i(),o("span",L,"ç§æœ‰"))]),m("div",I,r(b.comment.content),1),m("div",V,[m("button",{onClick:K,class:l(["action-btn like-btn",{liked:_.value}])},r(_.value?"â¤ï¸":"ðŸ¤")+" "+r(b.comment.likeCount||0),3),m("button",{onClick:t[0]||(t[0]=e=>P.value=!P.value),class:"action-btn"},"å›žå¤"),B.value?(i(),o("button",{key:0,onClick:R,class:l(["action-btn visibility-btn",{private:!b.comment.isPublic}])},r(b.comment.isPublic?"è®¾ä¸ºç§æœ‰":"è®¾ä¸ºå…¬å¼€"),3)):s("",!0),U.value?(i(),o("button",{key:1,onClick:F,class:"action-btn delete-btn"}," åˆ é™¤ ")):s("",!0)]),P.value?(i(),o("div",E,[d(m("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>W.value=e),placeholder:"è¾“å…¥ä½ çš„å›žå¤...",rows:"3"},null,512),[[c,W.value]]),m("div",Y,[m("label",q,[d(m("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>S.value=e),type:"checkbox",class:"checkbox-input"},null,512),[[u,S.value]]),t[6]||(t[6]=m("span",{class:"checkbox-text"},"å…¬å¼€å›žå¤",-1))])]),m("button",{onClick:J,disabled:$.value},"æäº¤å›žå¤",8,H),m("button",{onClick:t[3]||(t[3]=e=>P.value=!1),class:"cancel-btn"},"å–æ¶ˆ")])):s("",!0)])]),b.comment.replies&&b.comment.replies.length>0?(i(),o("div",O,[(i(!0),o(h,null,p(b.comment.replies,a=>(i(),v(y,{key:a.id||a._id,comment:a,depth:b.depth+1,onCommentDeleted:t[4]||(t[4]=t=>e.$emit("comment-deleted",t)),onCommentAdded:t[5]||(t[5]=t=>e.$emit("comment-added",t))},null,8,["comment","depth"]))),128))])):s("",!0)],6)}}},[["__scopeId","data-v-5277ada2"]]);export{U as C,M as c};
