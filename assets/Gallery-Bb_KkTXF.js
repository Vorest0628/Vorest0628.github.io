import{r as a,c as e,j as l,S as s,y as t,z as i,A as n,K as o,H as c,P as r,a6 as u,D as v,O as d,V as g,a1 as y,C as h}from"./vue-core-BYuX5Vli.js";import{g as p}from"./gallery-DWscGW5t.js";import{_ as m}from"./index-B6AuLqK3.js";import"./element-ui-drMXFw0_.js";import"./utils-DA1bHc0c.js";const k={class:"modern-gallery"},f={class:"gallery-filters"},w={class:"filter-section"},b={class:"filter-pills"},C=["onClick"],x={key:0,class:"filter-section"},T={class:"filter-pills"},z=["onClick"],L={key:0,class:"loading-state"},j={key:1,class:"error-state"},M={key:2,class:"masonry-grid"},S=["onClick"],_={class:"image-container"},B=["src","alt"],E={class:"image-overlay"},D={class:"overlay-content"},$={key:0},A={class:"image-meta"},W={class:"category-badge"},I={key:0,class:"tags"},G={key:0,class:"tag-more"},H={key:3,class:"empty-state"},K={class:"lightbox-image"},N=["src","alt"],O={class:"lightbox-info"},P={key:0},R={class:"lightbox-meta"},V={class:"meta-item"},q={key:0,class:"meta-item"},F={key:1,class:"lightbox-tags"},J=m({__name:"Gallery",setup(m){const J=a("全部"),Q=a("全部"),U=a(!1),X=a(null),Y=a(0),Z=a(!1),aa=a(""),ea=a([]);a([]),a([]);const la=e(()=>["全部",...new Set(ea.value.map(a=>a.category).filter(Boolean))]),sa=e(()=>"全部"===J.value?[...new Set(ea.value.flatMap(a=>a.secondaryTags||[]))]:[...new Set(ea.value.filter(a=>a.category===J.value).flatMap(a=>a.secondaryTags||[]))]),ta=e(()=>{let a=ea.value;return"全部"!==J.value&&(a=a.filter(a=>a.category===J.value)),"全部"!==Q.value&&(a=a.filter(a=>a.secondaryTags&&a.secondaryTags.includes(Q.value))),a}),ia=async()=>{Z.value=!0,aa.value="";try{const a=await p.getImages({page:1,limit:100});if(!a.success)throw new Error(a.message||"获取图片失败");ea.value=a.data.images||[]}catch(a){aa.value=a.message||"获取图片失败，请稍后重试",ea.value=[]}finally{Z.value=!1}},na=a=>{Q.value=a},oa=()=>{U.value=!1,X.value=null,document.body.style.overflow="auto"},ca=()=>{Y.value>0&&(Y.value--,X.value=ta.value[Y.value])},ra=()=>{Y.value<ta.value.length-1&&(Y.value++,X.value=ta.value[Y.value])},ua=a=>{if(!a)return"/placeholder.jpg";if(a.startsWith("http"))return a;const e="undefined"==typeof window||"shirakawananase.top"!==window.location.hostname&&!window.location.hostname.endsWith(".shirakawananase.top")?"http://localhost:3000":"https://api.shirakawananase.top";return a.startsWith("/")?`${e}${a}`:`${e}/${a}`},va=a=>{a.target.src="/placeholder.jpg"},da=a=>{if(U.value)switch(a.key){case"Escape":oa();break;case"ArrowLeft":ca();break;case"ArrowRight":ra()}};return l(()=>{ia(),document.addEventListener("keydown",da)}),s(()=>{document.removeEventListener("keydown",da),document.body.style.overflow="auto"}),(a,e)=>{return i(),t("div",k,[e[13]||(e[13]=n("div",{class:"gallery-header"},[n("h1",null,"图库展示"),n("p",{class:"subtitle"},"精选作品集合")],-1)),n("div",f,[n("div",w,[e[2]||(e[2]=n("h3",null,"分类",-1)),n("div",b,[(i(!0),t(r,null,u(la.value,a=>(i(),t("button",{key:a,onClick:e=>(a=>{J.value=a,Q.value="全部"})(a),class:v([{active:J.value===a},"filter-pill"])},d(a),11,C))),128))])]),sa.value.length>0?(i(),t("div",x,[e[3]||(e[3]=n("h3",null,"标签",-1)),n("div",T,[n("button",{onClick:e[0]||(e[0]=a=>na("全部")),class:v([{active:"全部"===Q.value},"filter-pill"])}," 全部 ",2),(i(!0),t(r,null,u(sa.value,a=>(i(),t("button",{key:a,onClick:e=>na(a),class:v([{active:Q.value===a},"filter-pill"])},d(a),11,z))),128))])])):o("",!0)]),Z.value?(i(),t("div",L,e[4]||(e[4]=[n("div",{class:"loading-spinner"},null,-1),n("p",null,"正在加载图片...",-1)]))):aa.value?(i(),t("div",j,[e[5]||(e[5]=n("div",{class:"error-icon"},"😞",-1)),e[6]||(e[6]=n("h3",null,"加载失败",-1)),n("p",null,d(aa.value),1),n("button",{onClick:ia,class:"retry-btn"},"重试")])):(i(),t("div",M,[(i(!0),t(r,null,u(ta.value,(a,l)=>(i(),t("div",{key:a._id||a.id,class:"masonry-item",style:h({animationDelay:50*l+"ms"}),onClick:e=>((a,e)=>{X.value=a,Y.value=e,U.value=!0,document.body.style.overflow="hidden"})(a,l)},[n("div",_,[n("img",{src:ua(a.thumbnail),alt:a.title,loading:"lazy",onError:va},null,40,B),n("div",E,[n("div",D,[n("h4",null,d(a.title),1),a.description?(i(),t("p",$,d(a.description),1)):o("",!0),n("div",A,[n("span",W,d(a.category),1),a.secondaryTags&&a.secondaryTags.length?(i(),t("div",I,[(i(!0),t(r,null,u(a.secondaryTags.slice(0,3),a=>(i(),t("span",{key:a,class:"tag-badge"},d(a),1))),128)),a.secondaryTags.length>3?(i(),t("span",G," +"+d(a.secondaryTags.length-3),1)):o("",!0)])):o("",!0)])]),e[7]||(e[7]=n("div",{class:"overlay-actions"},[n("button",{class:"action-btn view-btn"},[n("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor"},[n("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})])])],-1))])])],12,S))),128))])),Z.value||aa.value||0!==ta.value.length?o("",!0):(i(),t("div",H,[e[8]||(e[8]=n("div",{class:"empty-icon"},"🖼️",-1)),e[9]||(e[9]=n("h3",null,"暂无图片",-1)),n("p",null,d("全部"!==J.value||"全部"!==Q.value?"没有找到匹配的图片，请尝试其他筛选条件":"还没有上传任何图片"),1)])),(i(),c(y,{to:"body"},[U.value?(i(),t("div",{key:0,class:"lightbox-overlay",onClick:oa},[n("div",{class:"lightbox-container",onClick:e[1]||(e[1]=g(()=>{},["stop"]))},[n("button",{class:"lightbox-close",onClick:oa},e[10]||(e[10]=[n("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"},[n("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])),n("div",K,[n("img",{src:ua(X.value.fullSize||X.value.thumbnail),alt:X.value.title},null,8,N)]),n("div",O,[n("h3",null,d(X.value.title),1),X.value.description?(i(),t("p",P,d(X.value.description),1)):o("",!0),n("div",R,[n("span",V,"分类："+d(X.value.category),1),X.value.date?(i(),t("span",q,d((l=X.value.date,new Date(l).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}))),1)):o("",!0)]),X.value.secondaryTags&&X.value.secondaryTags.length?(i(),t("div",F,[(i(!0),t(r,null,u(X.value.secondaryTags,a=>(i(),t("span",{key:a,class:"lightbox-tag"},d(a),1))),128))])):o("",!0)]),Y.value>0?(i(),t("button",{key:0,onClick:ca,class:"lightbox-nav prev"},e[11]||(e[11]=[n("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"},[n("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})],-1)]))):o("",!0),Y.value<ta.value.length-1?(i(),t("button",{key:1,onClick:ra,class:"lightbox-nav next"},e[12]||(e[12]=[n("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"},[n("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})],-1)]))):o("",!0)])])):o("",!0)]))]);var l}}},[["__scopeId","data-v-3e175de4"]]);export{J as default};
