import{aO as e,r as t,j as a,y as l,z as s,A as n,K as c,O as o,P as i,a6 as r,D as u,V as m,J as d,aj as g,M as p,ae as v}from"./vue-core-BH5VTiN9.js";import{u as b}from"./UserPanel-Bz18ivhV.js";import{_ as y}from"./index-BPjNz-Ae.js";import"./element-ui-B3nexxj5.js";import"./utils-DA1bHc0c.js";const h={class:"user-comment-manager"},k={key:0,class:"loading-state"},C={key:1,class:"error-state"},f={key:2,class:"comments-list"},T={class:"comment-header"},w={class:"comment-meta"},P={class:"comment-time"},_={class:"comment-source"},I=["onClick","title"],D={class:"comment-content"},j={key:0,class:"parent-comment"},S={class:"parent-content"},x={class:"comment-actions"},M={class:"like-count"},A=["onClick"],B=["onClick"],G=["onClick"],O=["onClick"],$={key:0,class:"empty-state"},E={class:"modal-body"},U={class:"form-group"},V={class:"form-group"},N={class:"checkbox-label"},q={class:"form-actions"},z=["disabled"],J=y({__name:"UserCommentManager",setup(y){const J=e(),K=t([]),L=t(null),F=t({}),H=t(!1),Q=t(""),R=t(!1),W=async()=>{H.value=!0,Q.value="";try{const e=await b.getMyComments();if(!e.success)throw new Error(e.message||"è·å–è¯„è®ºå¤±è´¥");K.value=e.data.comments||[]}catch(e){Q.value=e.message||"åŠ è½½è¯„è®ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•",e.response&&404===e.response.status?K.value=[]:K.value=[{_id:"1",content:"è¿™æ˜¯ä¸€æ¡åšå®¢è¯„è®ºæµ‹è¯•",isPublic:!0,targetType:"Blog",targetId:"blog123",targetTitle:"å‰ç«¯å¼€å‘æŠ€å·§åˆ†äº«",createdAt:(new Date).toISOString(),parentComment:null},{_id:"2",content:"è¿™æ˜¯å¯¹å¦ä¸€æ¡è¯„è®ºçš„å›å¤",isPublic:!0,targetType:"Blog",targetId:"blog456",targetTitle:"Vue3 å¼€å‘å®æˆ˜",createdAt:new Date(Date.now()-864e5).toISOString(),parentComment:{content:"åŸå§‹è¯„è®ºå†…å®¹"}},{_id:"3",content:"æ–‡æ¡£è¯„è®ºæµ‹è¯•",isPublic:!0,targetType:"Document",targetId:"doc789",targetTitle:"å¼€å‘æ–‡æ¡£è¯´æ˜",createdAt:new Date(Date.now()-1728e5).toISOString(),parentComment:null}]}finally{H.value=!1}},X=e=>{if("blog"===e.targetType||"Blog"===e.targetType)if(e.targetId){const t="object"==typeof e.targetId?e.targetId.id||e.targetId._id:e.targetId;J.push(`/blog/${t}`)}else alert("åšå®¢IDç¼ºå¤±ï¼Œæ— æ³•è·³è½¬");else"comment"===e.targetType?J.push("/comments"):"document"===e.targetType||"Document"===e.targetType?e.targetTitle?J.push({path:"/documents",query:{search:e.targetTitle}}):J.push("/documents"):"General"===e.targetType?J.push("/comments"):"gallery"===e.targetType||"Gallery"===e.targetType?J.push("/gallery"):alert("æ— æ³•ç¡®å®šè·³è½¬ç›®æ ‡ï¼Œå¯èƒ½æ˜¯æ•°æ®ä¸å®Œæ•´")},Y=e=>{const t={blog:"åšå®¢",Blog:"åšå®¢",comment:"è¯„è®ºåŒº",document:"æ–‡æ¡£",Document:"æ–‡æ¡£",gallery:"å›¾åº“",Gallery:"å›¾åº“",General:"ç•™è¨€æ¿"}[e.targetType]||"å…¶ä»–";const a=e.targetTitle||"";return"blog"===e.targetType||"Blog"===e.targetType?a?`åšå®¢ï¼š${a}`:"åšå®¢":"General"===e.targetType?"ç•™è¨€æ¿":a?`${t}ï¼š${a}`:t},Z=()=>{L.value=null,F.value={}},ee=async()=>{if(L.value){R.value=!0;try{const e=await b.updateMyComment(L.value.id||L.value._id,F.value);if(!e.success)throw new Error(e.message||"æ›´æ–°å¤±è´¥");{const e=K.value.findIndex(e=>(e.id||e._id)===(L.value.id||L.value._id));-1!==e&&(K.value[e]={...K.value[e],...F.value}),Z(),alert("è¯„è®ºæ›´æ–°æˆåŠŸï¼")}}catch(e){alert("ä¿å­˜å¤±è´¥ï¼š"+e.message)}finally{R.value=!1}}},te=()=>{J.push("/comments")},ae=e=>{if(!e)return"æœªçŸ¥æ—¶é—´";const t=new Date(e);return isNaN(t.getTime())?"æœªçŸ¥æ—¶é—´":t.toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return a(()=>{W()}),(e,t)=>(s(),l("div",h,[t[12]||(t[12]=n("div",{class:"manager-header"},[n("h2",null,"æˆ‘çš„è¯„è®º"),n("p",null,"ç®¡ç†æ‚¨å‘è¡¨çš„è¯„è®º")],-1)),H.value?(s(),l("div",k,t[3]||(t[3]=[n("p",null,"åŠ è½½ä¸­...",-1)]))):Q.value?(s(),l("div",C,[n("p",null,o(Q.value),1),n("button",{onClick:W,class:"retry-btn"},"é‡è¯•")])):(s(),l("div",f,[(s(!0),l(i,null,r(K.value,e=>(s(),l("div",{key:e.id||e._id,class:"comment-card"},[n("div",T,[n("div",w,[n("span",P,o(ae(e.createdAt)),1),n("span",{class:u(["status-badge",e.isPublic?"public":"private"])},o(e.isPublic?"å…¬å¼€":"ç§æœ‰"),3),n("div",_,[t[4]||(t[4]=n("span",{class:"source-label"},"æ¥æº:",-1)),n("button",{onClick:t=>X(e),class:"source-link",title:`ç‚¹å‡»è·³è½¬åˆ°${Y(e)}`},o(Y(e)),9,I)])])]),n("div",D,o(e.content),1),e.parentComment?(s(),l("div",j,[t[5]||(t[5]=n("span",{class:"parent-label"},"å›å¤:",-1)),n("span",S,o(e.parentComment.content),1)])):c("",!0),n("div",x,[n("span",M,o(e.likeCount||0)+" â¤ï¸",1),n("button",{onClick:t=>(e=>{L.value=e,F.value={content:e.content,isPublic:e.isPublic}})(e),class:"edit-btn"},"ç¼–è¾‘",8,A),n("button",{onClick:t=>(async e=>{try{const t=await b.updateMyComment(e.id||e._id,{isPublic:!e.isPublic});if(!t.success)throw new Error(t.message||"æ›´æ–°å¤±è´¥");e.isPublic=!e.isPublic,alert("è¯„è®ºå·²"+(e.isPublic?"å…¬å¼€":"è®¾ä¸ºç§æœ‰"))}catch(t){alert("æ“ä½œå¤±è´¥ï¼š"+t.message)}})(e),class:"toggle-btn"},o(e.isPublic?"è®¾ä¸ºç§æœ‰":"è®¾ä¸ºå…¬å¼€"),9,B),n("button",{onClick:t=>X(e),class:"jump-btn"},"è·³è½¬åˆ°æ¥æº",8,G),n("button",{onClick:t=>(async e=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚"))try{const t=await b.deleteMyComment(e);if(!t.success)throw new Error(t.message||"åˆ é™¤å¤±è´¥");K.value=K.value.filter(t=>(t.id||t._id)!==e),alert("è¯„è®ºåˆ é™¤æˆåŠŸï¼")}catch(t){alert("åˆ é™¤å¤±è´¥ï¼š"+t.message)}})(e.id||e._id),class:"delete-btn"},"åˆ é™¤",8,O)])]))),128)),0===K.value.length?(s(),l("div",$,[t[6]||(t[6]=n("div",{class:"empty-icon"},"ğŸ’¬",-1)),t[7]||(t[7]=n("h3",null,"è¿˜æ²¡æœ‰è¯„è®º",-1)),t[8]||(t[8]=n("p",null,"å»å‘è¡¨æ‚¨çš„ç¬¬ä¸€æ¡è¯„è®ºå§ï¼",-1)),n("button",{onClick:te,class:"comment-btn"},"ç«‹å³è¯„è®º")])):c("",!0)])),L.value?(s(),l("div",{key:3,class:"modal-overlay",onClick:Z},[n("div",{class:"modal-content",onClick:t[2]||(t[2]=m(()=>{},["stop"]))},[n("div",{class:"modal-header"},[t[9]||(t[9]=n("h3",null,"ç¼–è¾‘è¯„è®º",-1)),n("button",{onClick:Z,class:"close-btn"},"âœ•")]),n("div",E,[n("form",{onSubmit:m(ee,["prevent"])},[n("div",U,[t[10]||(t[10]=n("label",null,"è¯„è®ºå†…å®¹",-1)),d(n("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>F.value.content=e),rows:"4",required:""},null,512),[[g,F.value.content]])]),n("div",V,[n("label",N,[d(n("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>F.value.isPublic=e),type:"checkbox"},null,512),[[v,F.value.isPublic]]),t[11]||(t[11]=p(" å…¬å¼€è¯„è®º "))])]),n("div",q,[n("button",{type:"button",onClick:Z,class:"cancel-btn"},"å–æ¶ˆ"),n("button",{type:"submit",class:"save-btn",disabled:R.value},o(R.value?"ä¿å­˜ä¸­...":"ä¿å­˜"),9,z)])],32)])])])):c("",!0)]))}},[["__scopeId","data-v-7ff73717"]]);export{J as default};
