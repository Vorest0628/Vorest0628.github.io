import{az as $,r as d,j as E,y as a,z as n,A as s,K as f,O as r,P as V,a6 as A,D as B,V as k,J as T,aj as N,M as j,ae as G}from"./vendor-CeqXcVya.js";import{u as y}from"./UserPanel-l2sN8Ips.js";import{_ as z}from"./index-BH5EIy1g.js";import"./particles-D6-XlEtG.js";const O={class:"user-comment-manager"},U={key:0,class:"loading-state"},F={key:1,class:"error-state"},q={key:2,class:"comments-list"},L={class:"comment-header"},J={class:"comment-meta"},K={class:"comment-time"},R={class:"comment-source"},H=["onClick","title"],Q={class:"comment-content"},W={key:0,class:"parent-comment"},X={class:"parent-content"},Y={class:"comment-actions"},Z={class:"like-count"},ee=["onClick"],te=["onClick"],se=["onClick"],le=["onClick"],oe={key:0,class:"empty-state"},ae={class:"modal-body"},ne={class:"form-group"},re={class:"form-group"},ie={class:"checkbox-label"},ue={class:"form-actions"},ce=["disabled"],de={__name:"UserCommentManager",setup(pe){const u=$(),o=d([]),c=d(null),i=d({}),_=d(!1),p=d(""),g=d(!1),m=async()=>{_.value=!0,p.value="";try{const e=await y.getMyComments();if(e.success)o.value=e.data.comments||[];else throw new Error(e.message||"è·å–è¯„è®ºå¤±è´¥")}catch(e){console.error("åŠ è½½è¯„è®ºå¤±è´¥:",e),p.value=e.message||"åŠ è½½è¯„è®ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•",e.response&&e.response.status===404?o.value=[]:o.value=[{_id:"1",content:"è¿™æ˜¯ä¸€æ¡åšå®¢è¯„è®ºæµ‹è¯•",isPublic:!0,targetType:"blog",targetId:"blog123",targetTitle:"å‰ç«¯å¼€å‘æŠ€å·§åˆ†äº«",createdAt:new Date().toISOString(),parentComment:null},{_id:"2",content:"è¿™æ˜¯å¯¹å¦ä¸€æ¡è¯„è®ºçš„å›å¤",isPublic:!0,targetType:"blog",targetId:"blog456",targetTitle:"Vue3 å¼€å‘å®æˆ˜",createdAt:new Date(Date.now()-864e5).toISOString(),parentComment:{content:"åŸå§‹è¯„è®ºå†…å®¹"}},{_id:"3",content:"æ–‡æ¡£è¯„è®ºæµ‹è¯•",isPublic:!0,targetType:"document",targetId:"doc789",targetTitle:"å¼€å‘æ–‡æ¡£è¯´æ˜",createdAt:new Date(Date.now()-1728e5).toISOString(),parentComment:null}]}finally{_.value=!1}},C=e=>{if(console.log("è·³è½¬è¯„è®ºæ¥æº:",e),e.targetType==="blog"||e.targetType==="Blog")if(e.targetId){const t=typeof e.targetId=="object"?e.targetId._id:e.targetId;u.push(`/blog/${t}`)}else alert("åšå®¢IDç¼ºå¤±ï¼Œæ— æ³•è·³è½¬");else e.targetType==="comment"?u.push("/comments"):e.targetType==="document"||e.targetType==="Document"?e.targetTitle?u.push({path:"/documents",query:{search:e.targetTitle}}):u.push("/documents"):e.targetType==="General"?u.push("/comments"):e.targetType==="gallery"||e.targetType==="Gallery"?u.push("/gallery"):(console.warn("æœªçŸ¥çš„ç›®æ ‡ç±»å‹:",e.targetType,e),alert("æ— æ³•ç¡®å®šè·³è½¬ç›®æ ‡ï¼Œå¯èƒ½æ˜¯æ•°æ®ä¸å®Œæ•´"))},w=e=>({blog:"åšå®¢",Blog:"åšå®¢",comment:"è¯„è®ºåŒº",document:"æ–‡æ¡£",Document:"æ–‡æ¡£",gallery:"å›¾åº“",Gallery:"å›¾åº“",General:"ç•™è¨€æ¿"})[e]||"å…¶ä»–",h=e=>{const t=w(e.targetType),l=e.targetTitle||"";return e.targetType==="blog"||e.targetType==="Blog"?l?`åšå®¢ï¼š${l}`:"åšå®¢":e.targetType==="General"?"ç•™è¨€æ¿":l?`${t}ï¼š${l}`:t},P=e=>{c.value=e,i.value={content:e.content,isPublic:e.isPublic}},v=()=>{c.value=null,i.value={}},D=async()=>{if(c.value){g.value=!0;try{const e=await y.updateMyComment(c.value._id,i.value);if(e.success){const t=o.value.findIndex(l=>l._id===c.value._id);t!==-1&&(o.value[t]={...o.value[t],...i.value}),v(),alert("è¯„è®ºæ›´æ–°æˆåŠŸï¼")}else throw new Error(e.message||"æ›´æ–°å¤±è´¥")}catch(e){console.error("ä¿å­˜å¤±è´¥:",e),alert("ä¿å­˜å¤±è´¥ï¼š"+e.message)}finally{g.value=!1}}},x=async e=>{try{const t=await y.updateMyComment(e._id,{isPublic:!e.isPublic});if(t.success)e.isPublic=!e.isPublic,alert(`è¯„è®ºå·²${e.isPublic?"å…¬å¼€":"è®¾ä¸ºç§æœ‰"}`);else throw new Error(t.message||"æ›´æ–°å¤±è´¥")}catch(t){console.error("åˆ‡æ¢çŠ¶æ€å¤±è´¥:",t),alert("æ“ä½œå¤±è´¥ï¼š"+t.message)}},I=async e=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚"))try{const t=await y.deleteMyComment(e);if(t.success)o.value=o.value.filter(l=>l._id!==e),alert("è¯„è®ºåˆ é™¤æˆåŠŸï¼");else throw new Error(t.message||"åˆ é™¤å¤±è´¥")}catch(t){console.error("åˆ é™¤å¤±è´¥:",t),alert("åˆ é™¤å¤±è´¥ï¼š"+t.message)}},M=()=>{u.push("/comments")},S=e=>{if(!e)return"æœªçŸ¥æ—¶é—´";const t=new Date(e);return isNaN(t.getTime())?"æœªçŸ¥æ—¶é—´":t.toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return E(()=>{m()}),(e,t)=>(n(),a("div",O,[t[12]||(t[12]=s("div",{class:"manager-header"},[s("h2",null,"æˆ‘çš„è¯„è®º"),s("p",null,"ç®¡ç†æ‚¨å‘è¡¨çš„è¯„è®º")],-1)),_.value?(n(),a("div",U,t[3]||(t[3]=[s("p",null,"åŠ è½½ä¸­...",-1)]))):p.value?(n(),a("div",F,[s("p",null,r(p.value),1),s("button",{onClick:m,class:"retry-btn"},"é‡è¯•")])):(n(),a("div",q,[(n(!0),a(V,null,A(o.value,l=>(n(),a("div",{key:l._id,class:"comment-card"},[s("div",L,[s("div",J,[s("span",K,r(S(l.createdAt)),1),s("span",{class:B(["status-badge",l.isPublic?"public":"private"])},r(l.isPublic?"å…¬å¼€":"ç§æœ‰"),3),s("div",R,[t[4]||(t[4]=s("span",{class:"source-label"},"æ¥æº:",-1)),s("button",{onClick:b=>C(l),class:"source-link",title:`ç‚¹å‡»è·³è½¬åˆ°${h(l)}`},r(h(l)),9,H)])])]),s("div",Q,r(l.content),1),l.parentComment?(n(),a("div",W,[t[5]||(t[5]=s("span",{class:"parent-label"},"å›å¤:",-1)),s("span",X,r(l.parentComment.content),1)])):f("",!0),s("div",Y,[s("span",Z,r(l.likeCount||0)+" â¤ï¸",1),s("button",{onClick:b=>P(l),class:"edit-btn"},"ç¼–è¾‘",8,ee),s("button",{onClick:b=>x(l),class:"toggle-btn"},r(l.isPublic?"è®¾ä¸ºç§æœ‰":"è®¾ä¸ºå…¬å¼€"),9,te),s("button",{onClick:b=>C(l),class:"jump-btn"},"è·³è½¬åˆ°æ¥æº",8,se),s("button",{onClick:b=>I(l._id),class:"delete-btn"},"åˆ é™¤",8,le)])]))),128)),o.value.length===0?(n(),a("div",oe,[t[6]||(t[6]=s("div",{class:"empty-icon"},"ğŸ’¬",-1)),t[7]||(t[7]=s("h3",null,"è¿˜æ²¡æœ‰è¯„è®º",-1)),t[8]||(t[8]=s("p",null,"å»å‘è¡¨æ‚¨çš„ç¬¬ä¸€æ¡è¯„è®ºå§ï¼",-1)),s("button",{onClick:M,class:"comment-btn"},"ç«‹å³è¯„è®º")])):f("",!0)])),c.value?(n(),a("div",{key:3,class:"modal-overlay",onClick:v},[s("div",{class:"modal-content",onClick:t[2]||(t[2]=k(()=>{},["stop"]))},[s("div",{class:"modal-header"},[t[9]||(t[9]=s("h3",null,"ç¼–è¾‘è¯„è®º",-1)),s("button",{onClick:v,class:"close-btn"},"âœ•")]),s("div",ae,[s("form",{onSubmit:k(D,["prevent"])},[s("div",ne,[t[10]||(t[10]=s("label",null,"è¯„è®ºå†…å®¹",-1)),T(s("textarea",{"onUpdate:modelValue":t[0]||(t[0]=l=>i.value.content=l),rows:"4",required:""},null,512),[[N,i.value.content]])]),s("div",re,[s("label",ie,[T(s("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>i.value.isPublic=l),type:"checkbox"},null,512),[[G,i.value.isPublic]]),t[11]||(t[11]=j(" å…¬å¼€è¯„è®º "))])]),s("div",ue,[s("button",{type:"button",onClick:v,class:"cancel-btn"},"å–æ¶ˆ"),s("button",{type:"submit",class:"save-btn",disabled:g.value},r(g.value?"ä¿å­˜ä¸­...":"ä¿å­˜"),9,ce)])],32)])])])):f("",!0)]))}},_e=z(de,[["__scopeId","data-v-a4a536ca"]]);export{_e as default};
