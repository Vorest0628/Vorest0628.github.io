import{az as $,r as d,j as E,y as a,z as n,A as s,K as f,O as r,P as V,a6 as A,D as B,V as k,J as T,aj as N,M as j,ae as G}from"./vendor-CeqXcVya.js";import{u as y}from"./UserPanel-l2sN8Ips.js";import{_ as z}from"./index-BH5EIy1g.js";import"./particles-D6-XlEtG.js";const O={class:"user-comment-manager"},U={key:0,class:"loading-state"},F={key:1,class:"error-state"},q={key:2,class:"comments-list"},L={class:"comment-header"},J={class:"comment-meta"},K={class:"comment-time"},R={class:"comment-source"},H=["onClick","title"],Q={class:"comment-content"},W={key:0,class:"parent-comment"},X={class:"parent-content"},Y={class:"comment-actions"},Z={class:"like-count"},ee=["onClick"],te=["onClick"],se=["onClick"],le=["onClick"],oe={key:0,class:"empty-state"},ae={class:"modal-body"},ne={class:"form-group"},re={class:"form-group"},ie={class:"checkbox-label"},ue={class:"form-actions"},ce=["disabled"],de={__name:"UserCommentManager",setup(pe){const u=$(),o=d([]),c=d(null),i=d({}),_=d(!1),p=d(""),g=d(!1),m=async()=>{_.value=!0,p.value="";try{const e=await y.getMyComments();if(e.success)o.value=e.data.comments||[];else throw new Error(e.message||"获取评论失败")}catch(e){console.error("加载评论失败:",e),p.value=e.message||"加载评论失败，请稍后重试",e.response&&e.response.status===404?o.value=[]:o.value=[{_id:"1",content:"这是一条博客评论测试",isPublic:!0,targetType:"blog",targetId:"blog123",targetTitle:"前端开发技巧分享",createdAt:new Date().toISOString(),parentComment:null},{_id:"2",content:"这是对另一条评论的回复",isPublic:!0,targetType:"blog",targetId:"blog456",targetTitle:"Vue3 开发实战",createdAt:new Date(Date.now()-864e5).toISOString(),parentComment:{content:"原始评论内容"}},{_id:"3",content:"文档评论测试",isPublic:!0,targetType:"document",targetId:"doc789",targetTitle:"开发文档说明",createdAt:new Date(Date.now()-1728e5).toISOString(),parentComment:null}]}finally{_.value=!1}},C=e=>{if(console.log("跳转评论来源:",e),e.targetType==="blog"||e.targetType==="Blog")if(e.targetId){const t=typeof e.targetId=="object"?e.targetId._id:e.targetId;u.push(`/blog/${t}`)}else alert("博客ID缺失，无法跳转");else e.targetType==="comment"?u.push("/comments"):e.targetType==="document"||e.targetType==="Document"?e.targetTitle?u.push({path:"/documents",query:{search:e.targetTitle}}):u.push("/documents"):e.targetType==="General"?u.push("/comments"):e.targetType==="gallery"||e.targetType==="Gallery"?u.push("/gallery"):(console.warn("未知的目标类型:",e.targetType,e),alert("无法确定跳转目标，可能是数据不完整"))},w=e=>({blog:"博客",Blog:"博客",comment:"评论区",document:"文档",Document:"文档",gallery:"图库",Gallery:"图库",General:"留言板"})[e]||"其他",h=e=>{const t=w(e.targetType),l=e.targetTitle||"";return e.targetType==="blog"||e.targetType==="Blog"?l?`博客：${l}`:"博客":e.targetType==="General"?"留言板":l?`${t}：${l}`:t},P=e=>{c.value=e,i.value={content:e.content,isPublic:e.isPublic}},v=()=>{c.value=null,i.value={}},D=async()=>{if(c.value){g.value=!0;try{const e=await y.updateMyComment(c.value._id,i.value);if(e.success){const t=o.value.findIndex(l=>l._id===c.value._id);t!==-1&&(o.value[t]={...o.value[t],...i.value}),v(),alert("评论更新成功！")}else throw new Error(e.message||"更新失败")}catch(e){console.error("保存失败:",e),alert("保存失败："+e.message)}finally{g.value=!1}}},x=async e=>{try{const t=await y.updateMyComment(e._id,{isPublic:!e.isPublic});if(t.success)e.isPublic=!e.isPublic,alert(`评论已${e.isPublic?"公开":"设为私有"}`);else throw new Error(t.message||"更新失败")}catch(t){console.error("切换状态失败:",t),alert("操作失败："+t.message)}},I=async e=>{if(confirm("确定要删除这条评论吗？此操作无法撤销。"))try{const t=await y.deleteMyComment(e);if(t.success)o.value=o.value.filter(l=>l._id!==e),alert("评论删除成功！");else throw new Error(t.message||"删除失败")}catch(t){console.error("删除失败:",t),alert("删除失败："+t.message)}},M=()=>{u.push("/comments")},S=e=>{if(!e)return"未知时间";const t=new Date(e);return isNaN(t.getTime())?"未知时间":t.toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return E(()=>{m()}),(e,t)=>(n(),a("div",O,[t[12]||(t[12]=s("div",{class:"manager-header"},[s("h2",null,"我的评论"),s("p",null,"管理您发表的评论")],-1)),_.value?(n(),a("div",U,t[3]||(t[3]=[s("p",null,"加载中...",-1)]))):p.value?(n(),a("div",F,[s("p",null,r(p.value),1),s("button",{onClick:m,class:"retry-btn"},"重试")])):(n(),a("div",q,[(n(!0),a(V,null,A(o.value,l=>(n(),a("div",{key:l._id,class:"comment-card"},[s("div",L,[s("div",J,[s("span",K,r(S(l.createdAt)),1),s("span",{class:B(["status-badge",l.isPublic?"public":"private"])},r(l.isPublic?"公开":"私有"),3),s("div",R,[t[4]||(t[4]=s("span",{class:"source-label"},"来源:",-1)),s("button",{onClick:b=>C(l),class:"source-link",title:`点击跳转到${h(l)}`},r(h(l)),9,H)])])]),s("div",Q,r(l.content),1),l.parentComment?(n(),a("div",W,[t[5]||(t[5]=s("span",{class:"parent-label"},"回复:",-1)),s("span",X,r(l.parentComment.content),1)])):f("",!0),s("div",Y,[s("span",Z,r(l.likeCount||0)+" ❤️",1),s("button",{onClick:b=>P(l),class:"edit-btn"},"编辑",8,ee),s("button",{onClick:b=>x(l),class:"toggle-btn"},r(l.isPublic?"设为私有":"设为公开"),9,te),s("button",{onClick:b=>C(l),class:"jump-btn"},"跳转到来源",8,se),s("button",{onClick:b=>I(l._id),class:"delete-btn"},"删除",8,le)])]))),128)),o.value.length===0?(n(),a("div",oe,[t[6]||(t[6]=s("div",{class:"empty-icon"},"💬",-1)),t[7]||(t[7]=s("h3",null,"还没有评论",-1)),t[8]||(t[8]=s("p",null,"去发表您的第一条评论吧！",-1)),s("button",{onClick:M,class:"comment-btn"},"立即评论")])):f("",!0)])),c.value?(n(),a("div",{key:3,class:"modal-overlay",onClick:v},[s("div",{class:"modal-content",onClick:t[2]||(t[2]=k(()=>{},["stop"]))},[s("div",{class:"modal-header"},[t[9]||(t[9]=s("h3",null,"编辑评论",-1)),s("button",{onClick:v,class:"close-btn"},"✕")]),s("div",ae,[s("form",{onSubmit:k(D,["prevent"])},[s("div",ne,[t[10]||(t[10]=s("label",null,"评论内容",-1)),T(s("textarea",{"onUpdate:modelValue":t[0]||(t[0]=l=>i.value.content=l),rows:"4",required:""},null,512),[[N,i.value.content]])]),s("div",re,[s("label",ie,[T(s("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>i.value.isPublic=l),type:"checkbox"},null,512),[[G,i.value.isPublic]]),t[11]||(t[11]=j(" 公开评论 "))])]),s("div",ue,[s("button",{type:"button",onClick:v,class:"cancel-btn"},"取消"),s("button",{type:"submit",class:"save-btn",disabled:g.value},r(g.value?"保存中...":"保存"),9,ce)])],32)])])])):f("",!0)]))}},_e=z(de,[["__scopeId","data-v-a4a536ca"]]);export{_e as default};
