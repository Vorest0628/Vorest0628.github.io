import{r as a,w as s,c as e,j as l,y as t,z as o,A as u,K as c,J as i,aj as n,P as v,a6 as r,O as d,aP as p,aW as g,D as y,V as m}from"./vue-core-BYuX5Vli.js";import{b}from"./blog-uF5hDeOs.js";import{_ as h}from"./index-B6AuLqK3.js";import"./element-ui-drMXFw0_.js";import"./utils-DA1bHc0c.js";const k={class:"blog"},f={class:"blog-filters"},C={class:"search-box"},w={class:"category-filter"},j=["onClick"],x={class:"blog-list"},_={key:0,class:"loading-state"},z={key:1,class:"error-state"},I=["onClick"],D={class:"post-main"},E={class:"post-body"},N={class:"post-header"},A={class:"post-meta"},B={class:"post-date"},P={class:"post-category"},S={class:"post-content"},V={class:"post-tags"},$={key:0,class:"post-cover"},q=["src","onError"],J={key:0,class:"empty-state"},K={key:1,class:"pagination"},L=["disabled"],M={class:"page-info"},O=["disabled"],T=h({__name:"Blog",setup(h){const T=p(),U=g(),W=a(""),F=a("全部"),G=a(1),H=a(!1),Q=a(""),R=a([]),X=a(["全部"]),Y=a(0);s(()=>U.query.search,a=>{a&&(W.value=a,F.value="全部",G.value=1,Z())},{immediate:!0});const Z=async()=>{H.value=!0,Q.value="";try{const a={page:G.value,pageSize:5,status:"published"};"全部"!==F.value&&(a.category=F.value),W.value&&(a.search=W.value);const s=await b.getBlogs(a);if(!s.success)throw new Error(s.message||"获取博客列表失败");R.value=s.data||[],Y.value=s.total}catch(a){Q.value=a.message||"加载博客失败，请稍后重试",R.value=[]}finally{H.value=!1}},aa=e(()=>R.value),sa=e(()=>Math.ceil(Y.value/5)),ea=()=>{G.value=1,Z()},la=a=>{a>=1&&a<=sa.value&&(G.value=a,Z())},ta=a=>{if(!a)return"未知日期";const s=new Date(a);return isNaN(s.getTime())?"未知日期":s.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})},oa=a=>{const s=null==a?void 0:a.coverImage;if(!s)return"";const e=/^(https?:|data:)/i.test(s),l=/^\/api\/blog\//i.test(s);return e?s:l?`https://api.shirakawananase.top${s}`:s};return l(async()=>{await(async()=>{try{const a=await b.getCategories();a.success&&(X.value=["全部",...a.data])}catch(a){X.value=["全部","前端开发","AI技术","游戏","音乐"]}})(),await Z()}),(a,s)=>(o(),t("div",k,[s[8]||(s[8]=u("h1",null,"我的博客",-1)),u("div",f,[u("div",C,[i(u("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=a=>W.value=a),placeholder:"搜索文章...",onInput:ea},null,544),[[n,W.value]])]),u("div",w,[(o(!0),t(v,null,r(X.value,a=>(o(),t("button",{key:a,onClick:s=>(a=>{F.value=a,G.value=1,Z()})(a),class:y([{active:F.value===a},"category-btn"])},d(a),11,j))),128))])]),u("div",x,[H.value?(o(),t("div",_,s[4]||(s[4]=[u("p",null,"正在加载博客文章...",-1)]))):Q.value?(o(),t("div",z,[s[5]||(s[5]=u("h3",null,"加载失败",-1)),u("p",null,d(Q.value),1),u("button",{onClick:Z,class:"retry-btn"},"重试")])):(o(!0),t(v,{key:2},r(aa.value,a=>(o(),t("article",{key:a.id,class:"blog-post",onClick:s=>{return e=a.id,void T.push(`/blog/${e}`);var e}},[u("div",D,[u("div",E,[u("div",N,[u("h2",null,d(a.title),1),u("div",A,[u("span",B,d(ta(a.date)),1),u("span",P,d(a.category),1)])]),u("div",S,[u("p",null,d(a.excerpt),1)]),u("div",V,[(o(!0),t(v,null,r(a.tags,a=>(o(),t("span",{key:a,class:"tag"},d(a),1))),128))])]),u("div",{class:"post-aside",onClick:s[1]||(s[1]=m(()=>{},["stop"]))},[oa(a)?(o(),t("div",$,[u("img",{src:oa(a),alt:"预览图",loading:"lazy",decoding:"async",onError:a=>{}},null,40,q)])):c("",!0),s[6]||(s[6]=u("div",{class:"post-footer"},[u("span",{class:"read-more"},"阅读更多 →")],-1))])])],8,I))),128))]),H.value||Q.value||0!==aa.value.length?c("",!0):(o(),t("div",J,[s[7]||(s[7]=u("h3",null,"暂无文章",-1)),u("p",null,d(W.value||"全部"!==F.value?"没有找到匹配的文章":"还没有发布任何文章"),1)])),sa.value>1?(o(),t("div",K,[u("button",{onClick:s[2]||(s[2]=a=>la(G.value-1)),disabled:1===G.value,class:"page-btn"}," 上一页 ",8,L),u("span",M," 第 "+d(G.value)+" 页，共 "+d(sa.value)+" 页 ",1),u("button",{onClick:s[3]||(s[3]=a=>la(G.value+1)),disabled:G.value===sa.value,class:"page-btn"}," 下一页 ",8,O)])):c("",!0)]))}},[["__scopeId","data-v-9fe1e619"]]);export{T as default};
