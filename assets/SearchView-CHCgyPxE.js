import{y as e,z as l,A as a,K as s,O as t,D as r,P as n,a6 as u,r as o,c as i,w as c,j as v,aW as d,aO as g,al as p,Q as y}from"./vue-core-BH5VTiN9.js";import{b as h,_ as m}from"./index-BPjNz-Ae.js";import"./element-ui-B3nexxj5.js";import"./utils-DA1bHc0c.js";const b=e=>h.get("/search",{params:e}),k={class:"search-view"},f={class:"search-header"},w={class:"search-info"},P={key:0},C={key:1},M={key:2,class:"result-stats"},T={class:"search-filters"},F={key:0,class:"loading"},q={key:1,class:"error-message"},z={key:2,class:"search-results"},D={key:0,class:"no-results"},L={key:1,class:"results-list"},S={class:"result-header"},x={class:"result-icon"},H={class:"result-type"},Q={key:0,class:"file-type"},j={class:"result-title"},R={class:"result-url"},$={class:"result-content"},B=["innerHTML"],E=["innerHTML"],I={class:"result-meta"},N={class:"result-date"},O={key:0,class:"result-category"},_={key:1,class:"download-count"},A={key:2,class:"file-size"},K={key:0,class:"result-tags"},G={key:0,class:"more-tags"},U={key:2,class:"pagination"},V=["disabled"],W={class:"page-numbers"},J=["onClick"],X=["disabled"];const Y=m({name:"SearchView",setup(){const e=d(),l=g(),a=o(!1),s=o(null),t=o(""),r=o({blogs:[],documents:[],combined:[]}),n=o("all"),u=o(1),p=o(0),y=o(0),h=o({blogs:0,documents:0,total:0}),m=o(0),k=i(()=>r.value?"all"===n.value?r.value.combined||[]:"blog"===n.value?r.value.blogs||[]:r.value.documents||[]:[]),f=i(()=>{const e=[],l=Math.max(1,u.value-2),a=Math.min(y.value,u.value+2);for(let s=l;s<=a;s++)e.push(s);return e}),w=async(e,l=1)=>{var t;if(!e)return;a.value=!0,s.value=null;const o=Date.now();try{const a={q:e,page:l,pageSize:10};"all"!==n.value&&(a.type=n.value);const s=await b(a);r.value=s.data||{blogs:[],documents:[],combined:[]},p.value=s.total||0,y.value=s.totalPages||0,u.value=s.page||1,h.value=s.resultCounts||{blogs:0,documents:0,total:0},m.value=((Date.now()-o)/1e3).toFixed(2)}catch(i){"ECONNREFUSED"===i.code||i.message.includes("Network Error")?s.value="æ— æ³•è¿žæŽ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·ç¡®ä¿åŽç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ":404===(null==(t=i.response)?void 0:t.status)?s.value="æœç´¢æŽ¥å£ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥APIé…ç½®":s.value=`æœç´¢å¤±è´¥ï¼š${i.message||"è¯·ç¨åŽå†è¯•"}`}finally{a.value=!1}},P=()=>{const e={q:t.value,page:u.value};"all"!==n.value&&(e.type=n.value),l.replace({query:e})};return c(()=>e.query,e=>{t.value=e.q||"",u.value=parseInt(e.page)||1,n.value=e.type||"all",t.value&&w(t.value,u.value)},{immediate:!0}),v(()=>{t.value=e.query.q||"",u.value=parseInt(e.query.page)||1,n.value=e.query.type||"all",t.value&&w(t.value,u.value)}),{loading:a,error:s,searchQuery:t,searchResults:r,activeFilter:n,currentPage:u,total:p,totalPages:y,resultCounts:h,searchTime:m,displayResults:k,visiblePages:f,search:w,setFilter:e=>{n.value=e,u.value=1,P(),w(t.value,1)},goToPage:e=>{e<1||e>y.value||(u.value=e,P(),w(t.value,e))},retry:()=>{w(t.value,u.value)},formatDate:e=>e?new Date(e).toLocaleDateString("zh-CN"):"",formatFileSize:e=>{if(!e)return"";const l=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,l)*100)/100+" "+["B","KB","MB","GB"][l]},window:window}}},[["render",function(o,i,c,v,d,g){var h,m,b;const Y=p("router-link");return l(),e("div",k,[a("div",f,[a("div",w,[v.searchQuery?(l(),e("h1",P,' "'+t(v.searchQuery)+'" çš„æœç´¢ç»“æžœ ',1)):(l(),e("h1",C,"æœç´¢ç»“æžœ")),v.searchQuery&&!v.loading?(l(),e("div",M," æ‰¾åˆ°çº¦ "+t(v.total)+" ä¸ªç»“æžœ ("+t(v.searchTime)+"ç§’) ",1)):s("",!0)]),a("div",T,[a("button",{class:r(["filter-btn",{active:"all"===v.activeFilter}]),onClick:i[0]||(i[0]=e=>v.setFilter("all"))}," å…¨éƒ¨ ("+t((null==(h=v.resultCounts)?void 0:h.total)||0)+") ",3),a("button",{class:r(["filter-btn",{active:"blog"===v.activeFilter}]),onClick:i[1]||(i[1]=e=>v.setFilter("blog"))}," ðŸ“ åšå®¢ ("+t((null==(m=v.resultCounts)?void 0:m.blogs)||0)+") ",3),a("button",{class:r(["filter-btn",{active:"document"===v.activeFilter}]),onClick:i[2]||(i[2]=e=>v.setFilter("document"))}," ðŸ“„ æ–‡æ¡£ ("+t((null==(b=v.resultCounts)?void 0:b.documents)||0)+") ",3)])]),v.loading?(l(),e("div",F,i[6]||(i[6]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"æ­£åœ¨æœç´¢...",-1)]))):s("",!0),v.error?(l(),e("div",q,[i[7]||(i[7]=a("div",{class:"error-icon"},"âŒ",-1)),a("p",null,t(v.error),1),a("button",{onClick:i[3]||(i[3]=(...e)=>v.retry&&v.retry(...e)),class:"retry-btn"},"é‡è¯•")])):s("",!0),v.loading||v.error?s("",!0):(l(),e("div",z,[0===v.displayResults.length&&v.searchQuery&&!v.loading?(l(),e("div",D,i[8]||(i[8]=[a("div",{class:"no-results-icon"},"ðŸ”",-1),a("h3",null,"æœªæ‰¾åˆ°ç›¸å…³ç»“æžœ",-1),a("p",null,"å°è¯•ä½¿ç”¨ä¸åŒçš„å…³é”®è¯æˆ–æ£€æŸ¥æ‹¼å†™",-1),a("div",{class:"search-suggestions"},[a("h4",null,"æœç´¢å»ºè®®ï¼š"),a("ul",null,[a("li",null,"ç¡®ä¿æ‰€æœ‰å•è¯æ‹¼å†™æ­£ç¡®"),a("li",null,"å°è¯•ä½¿ç”¨ä¸åŒçš„å…³é”®è¯"),a("li",null,"å°è¯•æ›´ä¸€èˆ¬çš„å…³é”®è¯"),a("li",null,"ä½¿ç”¨è¾ƒå°‘çš„å…³é”®è¯")])],-1)]))):(l(),e("div",L,[(l(!0),e(n,null,u(v.displayResults,r=>(l(),e("div",{key:`${r.type}-${r.id}`,class:"search-result-item"},[a("div",S,[a("span",x,t(r.icon),1),a("span",H,t(r.typeLabel),1),r.fileType?(l(),e("span",Q,t(r.fileType),1)):s("",!0)]),a("h3",j,[y(Y,{to:r.url,innerHTML:r.title},null,8,["to","innerHTML"])]),a("div",R,t(`${v.window.location.origin}${r.url}`),1),a("div",$,[r.excerpt?(l(),e("p",{key:0,innerHTML:r.excerpt,class:"result-excerpt"},null,8,B)):s("",!0),r.snippet?(l(),e("p",{key:1,innerHTML:r.snippet,class:"result-snippet"},null,8,E)):s("",!0)]),a("div",I,[a("span",N,t(v.formatDate(r.date)),1),r.category?(l(),e("span",O,t(r.category),1)):s("",!0),r.downloadCount?(l(),e("span",_," ä¸‹è½½: "+t(r.downloadCount),1)):s("",!0),r.fileSize?(l(),e("span",A," å¤§å°: "+t(v.formatFileSize(r.fileSize)),1)):s("",!0)]),r.tags&&r.tags.length?(l(),e("div",K,[(l(!0),e(n,null,u(r.tags.slice(0,3),a=>(l(),e("span",{key:a,class:"tag"},t(a),1))),128)),r.tags.length>3?(l(),e("span",G," +"+t(r.tags.length-3),1)):s("",!0)])):s("",!0)]))),128))])),v.totalPages>1?(l(),e("div",U,[a("button",{onClick:i[4]||(i[4]=e=>v.goToPage(v.currentPage-1)),disabled:1===v.currentPage,class:"page-btn"}," ä¸Šä¸€é¡µ ",8,V),a("div",W,[(l(!0),e(n,null,u(v.visiblePages,a=>(l(),e("button",{key:a,onClick:e=>v.goToPage(a),class:r(["page-number",{active:a===v.currentPage}])},t(a),11,J))),128))]),a("button",{onClick:i[5]||(i[5]=e=>v.goToPage(v.currentPage+1)),disabled:v.currentPage===v.totalPages,class:"page-btn"}," ä¸‹ä¸€é¡µ ",8,X)])):s("",!0)]))])}],["__scopeId","data-v-2ef509ad"]]);export{Y as default};
