import{aP as e,r as t,j as a,y as l,z as s,A as n,K as c,O as o,P as i,a6 as r,D as u,V as m,J as d,aj as g,M as p,ae as v}from"./vue-core-BYuX5Vli.js";import{u as b}from"./UserPanel-6kLqNBdo.js";import{_ as y}from"./index-B6AuLqK3.js";import"./element-ui-drMXFw0_.js";import"./utils-DA1bHc0c.js";const h={class:"user-comment-manager"},k={key:0,class:"loading-state"},C={key:1,class:"error-state"},f={key:2,class:"comments-list"},T={class:"comment-header"},w={class:"comment-meta"},P={class:"comment-time"},_={class:"comment-source"},I=["onClick","title"],D={class:"comment-content"},j={key:0,class:"parent-comment"},S={class:"parent-content"},x={class:"comment-actions"},M={class:"like-count"},A=["onClick"],B=["onClick"],G=["onClick"],$=["onClick"],E={key:0,class:"empty-state"},O={class:"modal-body"},U={class:"form-group"},V={class:"form-group"},N={class:"checkbox-label"},q={class:"form-actions"},z=["disabled"],J=y({__name:"UserCommentManager",setup(y){const J=e(),K=t([]),L=t(null),F=t({}),H=t(!1),Q=t(""),R=t(!1),W=async()=>{H.value=!0,Q.value="";try{const e=await b.getMyComments();if(!e.success)throw new Error(e.message||"获取评论失败");K.value=e.data.comments||[]}catch(e){Q.value=e.message||"加载评论失败，请稍后重试",e.response&&404===e.response.status?K.value=[]:K.value=[{_id:"1",content:"这是一条博客评论测试",isPublic:!0,targetType:"Blog",targetId:"blog123",targetTitle:"前端开发技巧分享",createdAt:(new Date).toISOString(),parentComment:null},{_id:"2",content:"这是对另一条评论的回复",isPublic:!0,targetType:"Blog",targetId:"blog456",targetTitle:"Vue3 开发实战",createdAt:new Date(Date.now()-864e5).toISOString(),parentComment:{content:"原始评论内容"}},{_id:"3",content:"文档评论测试",isPublic:!0,targetType:"Document",targetId:"doc789",targetTitle:"开发文档说明",createdAt:new Date(Date.now()-1728e5).toISOString(),parentComment:null}]}finally{H.value=!1}},X=e=>{if("blog"===e.targetType||"Blog"===e.targetType)if(e.targetId){const t="object"==typeof e.targetId?e.targetId.id||e.targetId._id:e.targetId;J.push(`/blog/${t}`)}else alert("博客ID缺失，无法跳转");else"comment"===e.targetType?J.push("/comments"):"document"===e.targetType||"Document"===e.targetType?e.targetTitle?J.push({path:"/documents",query:{search:e.targetTitle}}):J.push("/documents"):"General"===e.targetType?J.push("/comments"):"gallery"===e.targetType||"Gallery"===e.targetType?J.push("/gallery"):alert("无法确定跳转目标，可能是数据不完整")},Y=e=>{const t={blog:"博客",Blog:"博客",comment:"评论区",document:"文档",Document:"文档",gallery:"图库",Gallery:"图库",General:"留言板"}[e.targetType]||"其他";const a=e.targetTitle||"";return"blog"===e.targetType||"Blog"===e.targetType?a?`博客：${a}`:"博客":"General"===e.targetType?"留言板":a?`${t}：${a}`:t},Z=()=>{L.value=null,F.value={}},ee=async()=>{if(L.value){R.value=!0;try{const e=await b.updateMyComment(L.value.id||L.value._id,F.value);if(!e.success)throw new Error(e.message||"更新失败");{const e=K.value.findIndex(e=>(e.id||e._id)===(L.value.id||L.value._id));-1!==e&&(K.value[e]={...K.value[e],...F.value}),Z(),alert("评论更新成功！")}}catch(e){alert("保存失败："+e.message)}finally{R.value=!1}}},te=()=>{J.push("/comments")},ae=e=>{if(!e)return"未知时间";const t=new Date(e);return isNaN(t.getTime())?"未知时间":t.toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return a(()=>{W()}),(e,t)=>(s(),l("div",h,[t[12]||(t[12]=n("div",{class:"manager-header"},[n("h2",null,"我的评论"),n("p",null,"管理您发表的评论")],-1)),H.value?(s(),l("div",k,t[3]||(t[3]=[n("p",null,"加载中...",-1)]))):Q.value?(s(),l("div",C,[n("p",null,o(Q.value),1),n("button",{onClick:W,class:"retry-btn"},"重试")])):(s(),l("div",f,[(s(!0),l(i,null,r(K.value,e=>(s(),l("div",{key:e.id||e._id,class:"comment-card"},[n("div",T,[n("div",w,[n("span",P,o(ae(e.createdAt)),1),n("span",{class:u(["status-badge",e.isPublic?"public":"private"])},o(e.isPublic?"公开":"私有"),3),n("div",_,[t[4]||(t[4]=n("span",{class:"source-label"},"来源:",-1)),n("button",{onClick:t=>X(e),class:"source-link",title:`点击跳转到${Y(e)}`},o(Y(e)),9,I)])])]),n("div",D,o(e.content),1),e.parentComment?(s(),l("div",j,[t[5]||(t[5]=n("span",{class:"parent-label"},"回复:",-1)),n("span",S,o(e.parentComment.content),1)])):c("",!0),n("div",x,[n("span",M,o(e.likeCount||0)+" ❤️",1),n("button",{onClick:t=>(e=>{L.value=e,F.value={content:e.content,isPublic:e.isPublic}})(e),class:"edit-btn"},"编辑",8,A),n("button",{onClick:t=>(async e=>{try{const t=await b.updateMyComment(e.id||e._id,{isPublic:!e.isPublic});if(!t.success)throw new Error(t.message||"更新失败");e.isPublic=!e.isPublic,alert("评论已"+(e.isPublic?"公开":"设为私有"))}catch(t){alert("操作失败："+t.message)}})(e),class:"toggle-btn"},o(e.isPublic?"设为私有":"设为公开"),9,B),n("button",{onClick:t=>X(e),class:"jump-btn"},"跳转到来源",8,G),n("button",{onClick:t=>(async e=>{if(confirm("确定要删除这条评论吗？此操作无法撤销。"))try{const t=await b.deleteMyComment(e);if(!t.success)throw new Error(t.message||"删除失败");K.value=K.value.filter(t=>(t.id||t._id)!==e),alert("评论删除成功！")}catch(t){alert("删除失败："+t.message)}})(e.id||e._id),class:"delete-btn"},"删除",8,$)])]))),128)),0===K.value.length?(s(),l("div",E,[t[6]||(t[6]=n("div",{class:"empty-icon"},"💬",-1)),t[7]||(t[7]=n("h3",null,"还没有评论",-1)),t[8]||(t[8]=n("p",null,"去发表您的第一条评论吧！",-1)),n("button",{onClick:te,class:"comment-btn"},"立即评论")])):c("",!0)])),L.value?(s(),l("div",{key:3,class:"modal-overlay",onClick:Z},[n("div",{class:"modal-content",onClick:t[2]||(t[2]=m(()=>{},["stop"]))},[n("div",{class:"modal-header"},[t[9]||(t[9]=n("h3",null,"编辑评论",-1)),n("button",{onClick:Z,class:"close-btn"},"✕")]),n("div",O,[n("form",{onSubmit:m(ee,["prevent"])},[n("div",U,[t[10]||(t[10]=n("label",null,"评论内容",-1)),d(n("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>F.value.content=e),rows:"4",required:""},null,512),[[g,F.value.content]])]),n("div",V,[n("label",N,[d(n("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>F.value.isPublic=e),type:"checkbox"},null,512),[[v,F.value.isPublic]]),t[11]||(t[11]=p(" 公开评论 "))])]),n("div",q,[n("button",{type:"button",onClick:Z,class:"cancel-btn"},"取消"),n("button",{type:"submit",class:"save-btn",disabled:R.value},o(R.value?"保存中...":"保存"),9,z)])],32)])])])):c("",!0)]))}},[["__scopeId","data-v-7ff73717"]]);export{J as default};
