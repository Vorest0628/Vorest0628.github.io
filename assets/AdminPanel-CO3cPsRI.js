import{_ as ue,u as Be}from"./index-BH5EIy1g.js";import{r as b,X as ie,c as ee,j as de,y as r,z as n,A as e,H as oe,J as C,aj as E,aW as N,P as X,a6 as R,M as ne,K as M,O as c,D as Q,V as W,a1 as re,aA as $e,ae as Te,ag as we,C as ze,az as xe,L as Ee}from"./vendor-CeqXcVya.js";import{authStorage as De}from"./auth-4YeD0Oe7.js";import{adminApi as G}from"./admin-QLSWJlTk.js";import{m as Oe}from"./marked.esm-DKjyhwJX.js";import{f as ge}from"./friendLink-Ct1Qh6ee.js";import{g as me}from"./gallery-JWlZKpVC.js";import{d as Ne}from"./document-BdgFPKhx.js";import{U as je}from"./UserPanel-l2sN8Ips.js";import"./particles-D6-XlEtG.js";const qe={class:"admin-blog-manager"},Xe={class:"manager-header"},Re={class:"blog-list"},Ge={class:"list-header"},Je={class:"search-bar"},Qe={class:"filter-bar"},We={class:"blog-table"},He={class:"blog-title"},Ke={key:0,class:"pinned-indicator"},Ye={class:"blog-summary"},Ze={class:"category-badge"},et={class:"action-buttons"},tt=["onClick"],st=["onClick"],ot={class:"modal-header"},lt={class:"modal-body"},at={class:"form-group"},nt={class:"form-group"},rt={class:"form-group"},it={class:"content-header"},ut={class:"markdown-editor"},dt=["innerHTML"],ct={class:"form-group"},pt={class:"form-group"},vt=["value"],gt={key:0,class:"mt-2"},mt={class:"form-group"},ft={class:"form-actions"},yt={type:"submit",class:"save-btn"},bt={__name:"AdminBlogManager",setup(ce){const V=Be(),U=b([]),k=b([]),B=b(""),S=b(""),L=b(!1),A=b(!1),O=b(!1),D=b(""),P=b(null),_=b(["前端开发","AI技术","游戏","音乐"]),w=ie({id:null,title:"",excerpt:"",content:"",category:"",newCategoryText:"",tags:"",status:"draft"}),m=ee(()=>Oe(w.content||"")),q=f=>({draft:"草稿",published:"已发布",pinned:"置顶"})[f]||f,H=()=>{const f=new Set(["前端开发","AI技术","游戏","音乐"]);U.value.forEach(t=>{t.category&&f.add(t.category)}),_.value=Array.from(f).sort()},$=()=>{w.category!=="__other__"&&(w.newCategoryText="")},T=()=>{var f;(f=P.value)==null||f.click()},v=f=>{const t=f.target.files[0];if(!t)return;if(t.type&&t.type!=="text/markdown"&&!t.name.endsWith(".md")){alert("请选择一个 Markdown (.md) 文件。");return}const s=new FileReader;s.onload=u=>{w.content=u.target.result},s.onerror=u=>{console.error("文件读取失败",u),alert("文件读取失败")},s.readAsText(t)},x=async()=>{O.value=!0,D.value="";try{const f=await G.getAllBlogs();if(f.success)U.value=f.data.blogs||[],k.value=f.data.blogs||[],H();else throw new Error(f.message||"获取博客列表失败")}catch(f){console.error("获取博客列表失败:",f),D.value=f.message||"获取博客列表失败，请稍后重试",U.value=[],k.value=[]}finally{O.value=!1}},J=()=>{let f=U.value;if(B.value){const t=B.value.toLowerCase();f=f.filter(s=>s.title.toLowerCase().includes(t)||s.excerpt.toLowerCase().includes(t)||s.content.toLowerCase().includes(t)||s.tags&&s.tags.some(u=>u.toLowerCase().includes(t)))}S.value&&(f=f.filter(t=>t.status===S.value)),k.value=f},te=f=>{var t;Object.assign(w,{id:f._id||f.id,title:f.title,excerpt:f.excerpt,content:f.content,category:f.category,newCategoryText:"",tags:((t=f.tags)==null?void 0:t.join(","))||"",status:f.status||"draft"}),A.value=!0},Y=async()=>{try{console.log("🔍 开始保存博客..."),console.log("当前用户认证状态:",V.isAuthenticated),console.log("当前用户信息:",JSON.parse(JSON.stringify(V.user)));const f=w.category==="__other__"?w.newCategoryText.trim():w.category,t={title:w.title,excerpt:w.excerpt,content:w.content,category:f,tags:w.tags.split(",").map(u=>u.trim()).filter(Boolean),status:w.status};if(console.log("📝 准备发送的博客数据:",JSON.stringify(t,null,2)),!t.title){alert("请填写博客标题");return}if(!t.excerpt){alert("请填写博客摘要");return}if(!t.content){alert("请填写博客内容");return}if(!t.category){alert("请选择博客分类");return}if(w.category==="__other__"&&!w.newCategoryText.trim()){alert("请输入新分类名称");return}let s;if(L.value?(console.log("🆕 创建新博客..."),s=await G.createBlog(t)):(console.log("✏️ 更新博客..."),s=await G.updateBlog(w.id,t)),console.log("📤 API响应:",s),s.success)await x(),i(),alert(L.value?"博客创建成功!":"博客更新成功!");else throw new Error(s.message||"保存失败")}catch(f){console.error("❌ 保存博客失败:",f);let t="保存失败";if(f.response){console.error("错误响应状态:",f.response.status),console.error("错误响应数据:",f.response.data),console.error("错误响应头:",f.response.headers);const s=f.response.data;switch(s.message&&(t+=": "+s.message),f.response.status){case 400:t="数据验证失败 - 请检查所有必填字段是否正确填写",s.errors&&(console.error("验证错误详情:",s.errors),t+=`
详细错误: `+JSON.stringify(s.errors));break;case 401:t="认证失败 - 请重新登录";break;case 403:t="权限不足 - 您没有权限执行此操作";break;case 500:t="服务器内部错误 - 请稍后重试";break}}else f.request?(console.error("请求错误:",f.request),t="网络连接失败 - 请检查网络连接"):(console.error("其他错误:",f.message),t=f.message);alert(t)}},h=async f=>{if(confirm("确定要删除这篇博客吗？"))try{const t=await G.deleteBlog(f);if(t.success||t.message==="博客已删除")await x(),alert("博客删除成功!");else throw new Error(t.message||"删除失败")}catch(t){console.error("删除博客失败:",t),alert("删除失败: "+t.message)}},i=()=>{L.value=!1,A.value=!1,Object.assign(w,{id:null,title:"",excerpt:"",content:"",category:"",newCategoryText:"",tags:"",status:"draft"})},y=f=>{if(!f)return"N/A";const t=new Date(f);return isNaN(t.getTime())?"Invalid Date":t.toLocaleDateString("zh-CN")};return de(()=>{x()}),(f,t)=>(n(),r("div",qe,[e("div",Xe,[t[11]||(t[11]=e("h2",null,"博客管理",-1)),e("button",{onClick:t[0]||(t[0]=s=>L.value=!0),class:"create-btn"}," ➕ 创建博客 ")]),e("div",Re,[e("div",Ge,[e("div",Je,[C(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>B.value=s),placeholder:"搜索博客标题或内容...",onInput:J},null,544),[[E,B.value]])]),e("div",Qe,[C(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>S.value=s),onChange:J},t[12]||(t[12]=[e("option",{value:""},"全部状态",-1),e("option",{value:"published"},"已发布",-1),e("option",{value:"draft"},"草稿",-1),e("option",{value:"pinned"},"置顶",-1)]),544),[[N,S.value]])])]),e("div",We,[e("table",null,[t[13]||(t[13]=e("thead",null,[e("tr",null,[e("th",null,"标题"),e("th",null,"分类"),e("th",null,"状态"),e("th",null,"创建时间"),e("th",null,"更新时间"),e("th",null,"操作")])],-1)),e("tbody",null,[(n(!0),r(X,null,R(k.value,s=>(n(),r("tr",{key:s._id||s.id},[e("td",null,[e("div",He,[ne(c(s.title)+" ",1),s.status==="pinned"?(n(),r("span",Ke,"📌")):M("",!0),e("span",Ye,c(s.excerpt),1)])]),e("td",null,[e("span",Ze,c(s.category),1)]),e("td",null,[e("span",{class:Q(["status-badge",s.status])},c(q(s.status)),3)]),e("td",null,c(y(s.createdAt)),1),e("td",null,c(y(s.updatedAt)),1),e("td",null,[e("div",et,[e("button",{onClick:u=>te(s),class:"edit-btn"},"编辑",8,tt),e("button",{onClick:u=>h(s._id||s.id),class:"delete-btn"},"删除",8,st)])])]))),128))])])])]),(n(),oe(re,{to:"body"},[L.value||A.value?(n(),r("div",{key:0,class:"modal-overlay",onClick:i},[e("div",{class:"modal-content",onClick:t[10]||(t[10]=W(()=>{},["stop"]))},[e("div",ot,[e("h3",null,c(L.value?"创建博客":"编辑博客"),1),e("button",{onClick:i,class:"close-btn"},"✕")]),e("div",lt,[e("form",{onSubmit:W(Y,["prevent"])},[e("div",at,[t[14]||(t[14]=e("label",null,"标题",-1)),C(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>w.title=s),type:"text",required:""},null,512),[[E,w.title]])]),e("div",nt,[t[15]||(t[15]=e("label",null,"摘要",-1)),C(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=s=>w.excerpt=s),rows:"3"},null,512),[[E,w.excerpt]])]),e("div",rt,[e("div",it,[t[16]||(t[16]=e("label",null,"内容 (Markdown)",-1)),e("button",{type:"button",onClick:T,class:"upload-md-btn"},"从文件上传"),e("input",{type:"file",ref_key:"markdownFileInput",ref:P,onChange:v,accept:".md",style:{display:"none"}},null,544)]),e("div",ut,[C(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=s=>w.content=s),rows:"15",required:"",class:"markdown-input"},null,512),[[E,w.content]]),e("div",{innerHTML:m.value,class:"markdown-preview"},null,8,dt)])]),e("div",ct,[t[17]||(t[17]=e("label",null,"标签",-1)),C(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>w.tags=s),type:"text",placeholder:"用逗号分隔多个标签"},null,512),[[E,w.tags]])]),e("div",pt,[t[20]||(t[20]=e("label",null,"分类",-1)),C(e("select",{"onUpdate:modelValue":t[7]||(t[7]=s=>w.category=s),onChange:$,required:""},[t[18]||(t[18]=e("option",{value:""},"请选择分类",-1)),(n(!0),r(X,null,R(_.value,s=>(n(),r("option",{key:s,value:s},c(s),9,vt))),128)),t[19]||(t[19]=e("option",{value:"__other__"},"其他",-1))],544),[[N,w.category]]),w.category==="__other__"?(n(),r("div",gt,[C(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>w.newCategoryText=s),type:"text",placeholder:"输入新分类名称",required:"",class:"form-control"},null,512),[[E,w.newCategoryText]])])):M("",!0)]),e("div",mt,[t[22]||(t[22]=e("label",null,"状态",-1)),C(e("select",{"onUpdate:modelValue":t[9]||(t[9]=s=>w.status=s)},t[21]||(t[21]=[e("option",{value:"draft"},"草稿",-1),e("option",{value:"published"},"发布",-1),e("option",{value:"pinned"},"置顶",-1)]),512),[[N,w.status]])]),e("div",ft,[e("button",{type:"button",onClick:i,class:"cancel-btn"},"取消"),e("button",yt,c(L.value?"创建":"保存"),1)])],32)])])])):M("",!0)]))]))}},_t=ue(bt,[["__scopeId","data-v-b1b3e7a6"]]),wt={class:"admin-friend-link-manager"},ht={class:"manager-header"},$t={class:"filter-bar"},kt={key:0,class:"loading-state"},Ct={key:1,class:"error-state"},Tt={key:2,class:"friend-links-grid"},xt={class:"link-header"},Dt=["src","alt"],Ut={class:"link-info"},It={class:"link-name"},At={class:"link-url"},St=["href"],Mt={class:"link-content"},Lt={class:"link-description"},Ft={class:"link-meta"},Vt={class:"category"},Pt={class:"date"},Bt={class:"link-actions"},zt=["onClick"],Et=["onClick"],Ot=["onClick"],Nt=["onClick"],jt={key:3,class:"empty-state"},qt={class:"modal-header"},Xt={class:"modal-body"},Rt={class:"form-group"},Gt={class:"form-group"},Jt={class:"url-input-group"},Qt=["disabled"],Wt={class:"form-group"},Ht={class:"form-group"},Kt={class:"form-group"},Yt={class:"logo-input-group"},Zt={key:0,class:"logo-preview"},es=["src"],ts={class:"form-group"},ss={class:"form-group"},os={class:"form-group"},ls={class:"form-actions"},as={type:"submit",class:"save-btn"},ns={__name:"AdminFriendLinkManager",setup(ce){const V=b([]),U=b([]),k=b(!1),B=b(!1),S=b(!1),L=b(""),A=b(""),O=b(""),D=b(""),P=b(!1),_=ie({id:null,name:"",url:"",description:"",category:"",avatar:"",email:"",contactInfo:"",isActive:"false"}),w=ee(()=>!!_.id),m=async()=>{S.value=!0,L.value="";try{const t=await ge.getFriendLinks();if(t.success)V.value=t.data.friendLinks||t.data,U.value=t.data.friendLinks||t.data;else throw new Error(t.message||"获取友情链接失败")}catch(t){console.error("❌ 获取友情链接失败:",t),L.value=t.message||"获取友情链接失败，请稍后重试";const s=[{id:1,name:"Vue.js 官网",url:"https://vuejs.org",description:"The Progressive JavaScript Framework",category:"技术社区",avatar:"https://vuejs.org/logo.svg",isActive:!0,email:"admin@vuejs.org",contactInfo:"",createdAt:new Date().toISOString()},{id:2,name:"GitHub",url:"https://github.com",description:"Where the world builds software",category:"工具网站",avatar:"https://github.com/fluidicon.png",isActive:!0,email:"support@github.com",contactInfo:"",createdAt:new Date().toISOString()},{id:3,name:"测试博客",url:"https://example.com",description:"这是一个待审核的测试博客",category:"个人博客",avatar:"",isActive:!1,email:"test@example.com",contactInfo:"QQ: 123456789",createdAt:new Date().toISOString()}];V.value=s,U.value=s}finally{S.value=!1}},q=()=>{let t=V.value;if(A.value&&(A.value==="approved"?t=t.filter(s=>s.isActive===!0):A.value==="pending"&&(t=t.filter(s=>s.isActive===!1))),O.value&&(t=t.filter(s=>s.category===O.value)),D.value){const s=D.value.toLowerCase();t=t.filter(u=>{var j;return u.name.toLowerCase().includes(s)||((j=u.description)==null?void 0:j.toLowerCase().includes(s))||u.url.toLowerCase().includes(s)})}U.value=t},H=t=>{Object.assign(_,{id:t._id||t.id,name:t.name,url:t.url,description:t.description||"",category:t.category,avatar:t.avatar,email:t.email,contactInfo:t.contactInfo,isActive:t.isActive?"true":"false"}),B.value=!0},$=async()=>{var t,s;try{const u={name:_.name,url:_.url,description:_.description,category:_.category,avatar:_.avatar,email:_.email,contactInfo:_.contactInfo,isActive:_.isActive==="true"};w.value?(await ge.updateFriendLink(_.id,u),alert("友情链接更新成功!")):(await ge.createFriendLink(u),alert("友情链接创建成功!")),await m(),x()}catch(u){console.error("保存失败:",u),alert("保存失败: "+(((s=(t=u.response)==null?void 0:t.data)==null?void 0:s.message)||u.message))}},T=async(t,s)=>{var j,pe;const u=s?"通过":"禁用";if(confirm(`确定要${u}此友情链接吗？`))try{await ge.updateFriendLink(t,{isActive:s}),await m(),alert(`友情链接${u}成功!`)}catch(le){console.error("状态切换失败:",le),alert("状态切换失败: "+(((pe=(j=le.response)==null?void 0:j.data)==null?void 0:pe.message)||le.message))}},v=async t=>{var s,u;if(confirm("确定要删除这个友情链接吗？"))try{await ge.deleteFriendLink(t),await m(),alert("友情链接删除成功!")}catch(j){console.error("删除失败:",j),alert("删除失败: "+(((u=(s=j.response)==null?void 0:s.data)==null?void 0:u.message)||j.message))}},x=()=>{k.value=!1,B.value=!1,Object.assign(_,{id:null,name:"",url:"",description:"",category:"",avatar:"",email:"",contactInfo:"",isActive:"false"})},J=t=>new Date(t).toLocaleDateString("zh-CN"),te=t=>t?"approved":"pending",Y=t=>t?"已通过":"待审核",h=async()=>{var t,s;if(!_.url){alert("请先输入网站地址");return}P.value=!0;try{console.log("🔍 获取网站favicon:",_.url);const u=await ge.previewFavicon(_.url);u.success&&u.data.success?(_.avatar=u.data.faviconUrl,console.log("✅ Favicon获取成功:",u.data.faviconUrl),alert(`Favicon获取成功！
方法: ${u.data.method}
域名: ${u.data.domain}`)):(console.warn("⚠️ Favicon获取失败:",u.data),alert("无法获取网站图标，请手动输入Logo地址"))}catch(u){console.error("❌ 获取favicon失败:",u),alert("获取网站图标失败: "+(((s=(t=u.response)==null?void 0:t.data)==null?void 0:s.message)||u.message))}finally{P.value=!1}},i=async()=>{_.url&&!_.avatar&&await h()},y=t=>{console.warn("Logo加载失败:",t.target.src),t.target.src="/image/default-logo.png"},f=t=>t?t.startsWith("http")?t:`http://localhost:3000${t}`:"/image/default-logo.png";return de(()=>{m()}),(t,s)=>(n(),r("div",wt,[e("div",ht,[s[13]||(s[13]=e("h2",null,"友情链接管理",-1)),e("button",{onClick:s[0]||(s[0]=u=>k.value=!0),class:"create-btn"}," ➕ 添加友情链接 ")]),e("div",$t,[C(e("select",{"onUpdate:modelValue":s[1]||(s[1]=u=>A.value=u),onChange:q},s[14]||(s[14]=[e("option",{value:""},"全部状态",-1),e("option",{value:"approved"},"已通过",-1),e("option",{value:"pending"},"待审核",-1),e("option",{value:"rejected"},"已拒绝",-1)]),544),[[N,A.value]]),C(e("select",{"onUpdate:modelValue":s[2]||(s[2]=u=>O.value=u),onChange:q},s[15]||(s[15]=[$e('<option value="" data-v-7992140a>全部分类</option><option value="个人博客" data-v-7992140a>个人博客</option><option value="技术社区" data-v-7992140a>技术社区</option><option value="学习资源" data-v-7992140a>学习资源</option><option value="工具网站" data-v-7992140a>工具网站</option><option value="其他" data-v-7992140a>其他</option>',6)]),544),[[N,O.value]]),C(e("input",{"onUpdate:modelValue":s[3]||(s[3]=u=>D.value=u),placeholder:"搜索网站名称或描述...",onInput:q},null,544),[[E,D.value]])]),S.value?(n(),r("div",kt,s[16]||(s[16]=[e("p",null,"正在加载友情链接...",-1)]))):L.value?(n(),r("div",Ct,[s[17]||(s[17]=e("h3",null,"加载失败",-1)),e("p",null,c(L.value),1),e("button",{onClick:m,class:"retry-btn"},"重试")])):(n(),r("div",Tt,[(n(!0),r(X,null,R(U.value,u=>(n(),r("div",{key:u._id||u.id,class:"link-card"},[e("div",xt,[e("img",{src:f(u.avatar),alt:u.name,class:"link-logo"},null,8,Dt),e("div",Ut,[e("div",It,c(u.name),1),e("div",At,[e("a",{href:u.url,target:"_blank"},c(u.url),9,St)])])]),e("div",Mt,[e("div",Lt,c(u.description||"暂无描述"),1),e("div",Ft,[e("span",Vt,c(u.category),1),e("span",{class:Q(["status",te(u.isActive)])},c(Y(u.isActive)),3),e("span",Pt,c(J(u.createdAt)),1)])]),e("div",Bt,[e("button",{onClick:j=>H(u),class:"edit-btn"},"编辑",8,zt),u.isActive?M("",!0):(n(),r("button",{key:0,onClick:j=>T(u._id||u.id,!0),class:"approve-btn"}," 通过 ",8,Et)),u.isActive?(n(),r("button",{key:1,onClick:j=>T(u._id||u.id,!1),class:"reject-btn"}," 禁用 ",8,Ot)):M("",!0),e("button",{onClick:j=>v(u._id||u.id),class:"delete-btn"},"删除",8,Nt)])]))),128))])),!S.value&&!L.value&&U.value.length===0?(n(),r("div",jt,s[18]||(s[18]=[e("h3",null,"暂无友情链接",-1),e("p",null,"还没有任何友情链接，点击添加按钮开始创建",-1)]))):M("",!0),(n(),oe(re,{to:"body"},[k.value||B.value?(n(),r("div",{key:0,class:"modal-overlay",onClick:x},[e("div",{class:"modal-content",onClick:s[12]||(s[12]=W(()=>{},["stop"]))},[e("div",qt,[e("h3",null,c(w.value?"编辑友情链接":"添加友情链接"),1),e("button",{onClick:x,class:"close-btn"},"✕")]),e("div",Xt,[e("form",{onSubmit:W($,["prevent"])},[e("div",Rt,[s[19]||(s[19]=e("label",null,"网站名称",-1)),C(e("input",{"onUpdate:modelValue":s[4]||(s[4]=u=>_.name=u),type:"text",required:""},null,512),[[E,_.name]])]),e("div",Gt,[s[20]||(s[20]=e("label",null,"网站地址",-1)),e("div",Jt,[C(e("input",{"onUpdate:modelValue":s[5]||(s[5]=u=>_.url=u),type:"text",required:"",placeholder:"例如：www.example.com 或 https://www.example.com",onBlur:i},null,544),[[E,_.url]]),e("button",{type:"button",onClick:h,class:"fetch-favicon-btn",disabled:P.value||!_.url},c(P.value?"获取中...":"🔄 获取图标"),9,Qt)])]),e("div",Wt,[s[21]||(s[21]=e("label",null,"网站描述",-1)),C(e("textarea",{"onUpdate:modelValue":s[6]||(s[6]=u=>_.description=u),rows:"3"},null,512),[[E,_.description]])]),e("div",Ht,[s[23]||(s[23]=e("label",null,"分类",-1)),C(e("select",{"onUpdate:modelValue":s[7]||(s[7]=u=>_.category=u),required:""},s[22]||(s[22]=[e("option",{value:""},"选择分类",-1),e("option",{value:"个人博客"},"个人博客",-1),e("option",{value:"技术社区"},"技术社区",-1),e("option",{value:"学习资源"},"学习资源",-1),e("option",{value:"工具网站"},"工具网站",-1),e("option",{value:"其他"},"其他",-1)]),512),[[N,_.category]])]),e("div",Kt,[s[24]||(s[24]=e("label",null,"网站Logo",-1)),e("div",Yt,[C(e("input",{"onUpdate:modelValue":s[8]||(s[8]=u=>_.avatar=u),type:"url",placeholder:"自动获取或手动输入Logo地址"},null,512),[[E,_.avatar]]),_.avatar?(n(),r("div",Zt,[e("img",{src:_.avatar,alt:"Logo预览",onError:y},null,40,es)])):M("",!0)]),s[25]||(s[25]=e("small",{class:"form-hint"},"留空将自动获取网站favicon作为Logo",-1))]),e("div",ts,[s[26]||(s[26]=e("label",null,"联系邮箱",-1)),C(e("input",{"onUpdate:modelValue":s[9]||(s[9]=u=>_.email=u),type:"email"},null,512),[[E,_.email]])]),e("div",ss,[s[27]||(s[27]=e("label",null,"联系信息",-1)),C(e("input",{"onUpdate:modelValue":s[10]||(s[10]=u=>_.contactInfo=u),type:"text",placeholder:"QQ、微信等联系方式"},null,512),[[E,_.contactInfo]])]),e("div",os,[s[29]||(s[29]=e("label",null,"状态",-1)),C(e("select",{"onUpdate:modelValue":s[11]||(s[11]=u=>_.isActive=u)},s[28]||(s[28]=[e("option",{value:"false"},"待审核",-1),e("option",{value:"true"},"已通过",-1)]),512),[[N,_.isActive]])]),e("div",ls,[e("button",{type:"button",onClick:x,class:"cancel-btn"},"取消"),e("button",as,c(w.value?"更新":"创建"),1)])],32)])])])):M("",!0)]))]))}},rs=ue(ns,[["__scopeId","data-v-7992140a"]]),is={class:"admin-gallery-manager"},us={class:"manager-header"},ds={class:"header-actions"},cs={key:0,class:"batch-actions"},ps={class:"selection-count"},vs={class:"filter-bar"},gs={class:"filter-controls"},ms={class:"select-controls"},fs={class:"select-all-control"},ys=["checked","indeterminate"],bs={key:0,class:"loading-state"},_s={key:1,class:"error-state"},ws={key:2,class:"gallery-grid"},hs={class:"selection-checkbox"},$s=["checked","onChange"],ks={class:"image-preview"},Cs=["src","alt"],Ts={class:"image-overlay"},xs=["onClick"],Ds=["onClick"],Us={class:"image-info"},Is={class:"image-title"},As={class:"image-meta"},Ss={class:"category"},Ms={class:"upload-date"},Ls={key:0,class:"image-tags"},Fs={key:3,class:"empty-state"},Vs={class:"modal-body"},Ps={class:"form-group"},Bs=["value"],zs={key:0,class:"mt-2"},Es={key:0,class:"form-group"},Os={class:"tags-selection"},Ns=["id","value"],js=["for"],qs={class:"tag-item"},Xs={class:"form-group"},Rs={class:"status-selection"},Gs={key:1,class:"selected-files"},Js={class:"file-list"},Qs=["src","alt"],Ws={class:"file-info"},Hs={class:"file-name"},Ks={class:"file-size"},Ys=["onClick"],Zs={class:"modal-footer"},eo=["disabled"],to={class:"modal-body"},so={class:"form-group"},oo={class:"form-group"},lo=["value"],ao={class:"form-group"},no={class:"form-group"},ro={class:"visibility-options"},io={class:"form-group"},uo={key:0,class:"modal-overlay"},co={class:"modal-content batch-delete-modal"},po={class:"modal-body"},vo={class:"preview-images"},go=["src","alt"],mo={key:0,class:"more-count"},fo={class:"modal-footer"},yo=["disabled"],bo={__name:"AdminGalleryManager",setup(ce){const V=b([]),U=b([]),k=b([]),B=b(!1),S=b(!1),L=b(!1),A=b([]),O=b(!1),D=b(!1),P=b(""),_=b(""),w=b(!1),m=b(""),q=b([]),H=b(null),$=b(!1),T=b(["摄影","游戏","编程","设计"]),v=ie({category:"",tags:[],otherTagEnabled:!1,newTagText:"",isPublic:"true",otherCategoryEnabled:!1,newCategoryText:""}),x=ie({id:null,title:"",category:"",secondaryTagsInput:"",secondaryTags:[],isPublic:!0,status:"draft"}),J=ee(()=>U.value.length>0&&k.value.length===U.value.length),te=ee(()=>k.value.length>0&&k.value.length<U.value.length),Y=ee(()=>f(v.category)),h=async()=>{await Promise.all([z(),i()]),y()},i=async()=>{try{const p=await me.getTags();p.success&&(q.value=p.data||[])}catch(p){console.error("获取标签失败:",p)}},y=()=>{const p=new Set(["摄影","游戏","编程","设计"]);V.value.forEach(o=>{o.category&&p.add(o.category)}),T.value=Array.from(p).sort()},f=p=>{if(!p)return q.value;const o=V.value.filter(I=>I.category===p),a=new Set;return o.forEach(I=>{I.secondaryTags&&I.secondaryTags.length>0&&I.secondaryTags.forEach(fe=>a.add(fe))}),Array.from(a)},t=p=>k.value.some(o=>(o._id||o.id)===(p._id||p.id)),s=p=>{const o=p._id||p.id,a=k.value.findIndex(I=>(I._id||I.id)===o);a===-1?k.value.push(p):k.value.splice(a,1)},u=()=>{J.value?k.value=[]:k.value=[...U.value]},j=()=>{k.value=[]},pe=()=>{v.tags=[],v.otherTagEnabled=!1,v.newTagText="",v.category!=="__other__"&&(v.newCategoryText="")},le=()=>{k.value.length!==0&&(L.value=!0)},d=async()=>{var p,o;D.value=!0;try{const a=k.value.map(I=>me.deleteImage(I._id||I.id));await Promise.all(a),alert(`成功删除 ${k.value.length} 张图片！`),k.value=[],L.value=!1,await z(),y()}catch(a){console.error("批量删除失败:",a),alert("批量删除失败: "+(((o=(p=a.response)==null?void 0:p.data)==null?void 0:o.message)||a.message))}finally{D.value=!1}},l=()=>{L.value=!1},F=async()=>{var p,o;if(A.value.length!==0){if(!v.category){alert("请选择分类");return}if(v.category==="__other__"&&!v.newCategoryText.trim()){alert("请输入新分类名称");return}O.value=!0;try{const a=v.category==="__other__"?v.newCategoryText.trim():v.category;for(let I=0;I<A.value.length;I++){const fe=A.value[I],ae=new FormData;ae.append("image",fe.file),ae.append("title",fe.name.split(".")[0]),ae.append("category",a),ae.append("isPublic",v.isPublic),ae.append("status","published");let he=[...v.tags];if(v.otherTagEnabled&&v.newTagText){const Ve=v.newTagText.split(",").map(Pe=>Pe.trim()).filter(Boolean);he=[...he,...Ve]}ae.append("secondaryTags",JSON.stringify(he)),await me.uploadImage(ae)}alert("图片上传成功!"),await h(),be()}catch(a){console.error("上传失败:",a),alert("上传失败: "+(((o=(p=a.response)==null?void 0:p.data)==null?void 0:o.message)||a.message))}finally{O.value=!1}}},g=()=>{let p=V.value;if(P.value&&(p=p.filter(o=>o.category===P.value)),_.value){const o=_.value.toLowerCase();p=p.filter(a=>{var I;return a.title.toLowerCase().includes(o)||((I=a.description)==null?void 0:I.toLowerCase().includes(o))})}U.value=p,k.value=k.value.filter(o=>p.some(a=>(a._id||a.id)===(o._id||o.id)))},z=async()=>{w.value=!0,m.value="";try{const p=await me.getAllImages();if(p.success)V.value=p.data||[],U.value=p.data||[];else throw new Error(p.message||"获取图片列表失败")}catch(p){console.error("❌ 获取图片列表失败:",p),m.value=p.message||"获取图片列表失败，请稍后重试",V.value=[],U.value=[]}finally{w.value=!1}},Z=p=>{const o=Array.from(p.target.files);ke(o)},ve=()=>{H.value.click()},K=p=>{p.preventDefault(),$.value=!1;const o=Array.from(p.dataTransfer.files);ke(o)},ye=p=>{p.preventDefault(),$.value=!0},se=p=>{p.preventDefault(),p.currentTarget.contains(p.relatedTarget)||($.value=!1)},Ue=p=>{p.preventDefault()},ke=p=>{p.forEach(o=>{if(o.type.startsWith("image/")){const a=new FileReader;a.onload=I=>{A.value.push({file:o,name:o.name,size:o.size,preview:I.target.result})},a.readAsDataURL(o)}})},Ie=p=>{A.value.splice(p,1)},Ae=p=>{Object.assign(x,{id:p._id||p.id,title:p.title,category:p.category,secondaryTagsInput:(p.secondaryTags||[]).join(", "),secondaryTags:p.secondaryTags||[],isPublic:p.isPublic,status:p.status}),S.value=!0},Se=async()=>{var p,o;try{const a={title:x.title,category:x.category,secondaryTags:x.secondaryTagsInput.split(",").map(I=>I.trim()).filter(Boolean),isPublic:x.isPublic,status:x.status};await me.updateImage(x.id,a),alert("图片信息更新成功!"),_e(),await z()}catch(a){console.error("保存失败:",a),alert("保存失败: "+(((o=(p=a.response)==null?void 0:p.data)==null?void 0:o.message)||a.message))}},Me=async p=>{var o,a;if(confirm("确定要删除这张图片吗？"))try{await me.deleteImage(p),alert("图片删除成功!"),await z(),y()}catch(I){console.error("删除失败:",I),alert("删除失败: "+(((a=(o=I.response)==null?void 0:o.data)==null?void 0:a.message)||I.message))}},be=()=>{B.value=!1,A.value=[],$.value=!1,Object.assign(v,{category:"",tags:[],otherTagEnabled:!1,newTagText:"",isPublic:"true",otherCategoryEnabled:!1,newCategoryText:""})},_e=()=>{S.value=!1,Object.assign(x,{id:null,title:"",category:"",secondaryTagsInput:"",secondaryTags:[],isPublic:!0,status:"draft"})},Le=p=>{if(p===0)return"0 Bytes";const o=1024,a=["Bytes","KB","MB","GB"],I=Math.floor(Math.log(p)/Math.log(o));return parseFloat((p/Math.pow(o,I)).toFixed(2))+" "+a[I]},Fe=p=>new Date(p).toLocaleDateString("zh-CN"),Ce=p=>{if(!p)return"/placeholder.jpg";if(p.startsWith("http"))return p;const o="http://localhost:3000";return p.startsWith("/")?`${o}${p}`:`${o}/${p}`};return de(()=>{h()}),(p,o)=>(n(),r("div",is,[e("div",us,[o[18]||(o[18]=e("h2",null,"图库管理",-1)),e("div",ds,[k.value.length>0?(n(),r("div",cs,[e("span",ps,"已选择 "+c(k.value.length)+" 张图片",1),e("button",{onClick:le,class:"batch-delete-btn"}," 🗑️ 批量删除 ("+c(k.value.length)+") ",1),e("button",{onClick:j,class:"clear-selection-btn"}," ✕ 取消选择 ")])):M("",!0),e("button",{onClick:o[0]||(o[0]=a=>B.value=!0),class:"upload-btn"}," 📷 上传图片 ")])]),e("div",vs,[e("div",gs,[C(e("select",{"onUpdate:modelValue":o[1]||(o[1]=a=>P.value=a),onChange:g},o[19]||(o[19]=[$e('<option value="" data-v-22fff292>全部分类</option><option value="摄影" data-v-22fff292>摄影</option><option value="游戏" data-v-22fff292>游戏</option><option value="编程" data-v-22fff292>编程</option><option value="设计" data-v-22fff292>设计</option>',5)]),544),[[N,P.value]]),C(e("input",{"onUpdate:modelValue":o[2]||(o[2]=a=>_.value=a),placeholder:"搜索图片标题...",onInput:g},null,544),[[E,_.value]])]),e("div",ms,[e("label",fs,[e("input",{type:"checkbox",checked:J.value,indeterminate:te.value,onChange:u},null,40,ys),e("span",null,"全选 ("+c(U.value.length)+")",1)])])]),w.value?(n(),r("div",bs,o[20]||(o[20]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"正在加载图片...",-1)]))):m.value?(n(),r("div",_s,[o[21]||(o[21]=e("div",{class:"error-icon"},"😞",-1)),o[22]||(o[22]=e("h3",null,"加载失败",-1)),e("p",null,c(m.value),1),e("button",{onClick:z,class:"retry-btn"},"重试")])):(n(),r("div",ws,[(n(!0),r(X,null,R(U.value,a=>(n(),r("div",{key:a._id||a.id,class:Q(["image-card",{selected:t(a)}])},[e("div",hs,[e("input",{type:"checkbox",checked:t(a),onChange:I=>s(a)},null,40,$s)]),e("div",ks,[e("img",{src:Ce(a.thumbnail||a.url),alt:a.title},null,8,Cs),e("div",Ts,[e("button",{onClick:I=>Ae(a),class:"edit-btn"},"编辑",8,xs),e("button",{onClick:I=>Me(a._id||a.id),class:"delete-btn"},"删除",8,Ds)])]),e("div",Us,[e("div",Is,c(a.title),1),e("div",As,[e("span",Ss,c(a.category),1),e("span",Ms,c(Fe(a.date||a.createdAt)),1),e("span",{class:Q(["status",a.isPublic?"public":"private"])},c(a.isPublic?"公开":"私有"),3),e("span",{class:Q(["publish-status",a.status])},c(a.status==="published"?"已发布":"未发布"),3)]),a.secondaryTags&&a.secondaryTags.length?(n(),r("div",Ls,[(n(!0),r(X,null,R(a.secondaryTags,I=>(n(),r("span",{key:I,class:"tag"},c(I),1))),128))])):M("",!0)])],2))),128))])),!w.value&&!m.value&&U.value.length===0?(n(),r("div",Fs,o[23]||(o[23]=[e("div",{class:"empty-icon"},"🖼️",-1),e("h3",null,"暂无图片",-1),e("p",null,"还没有上传任何图片，点击上传按钮开始添加图片",-1)]))):M("",!0),(n(),oe(re,{to:"body"},[B.value?(n(),r("div",{key:0,class:"modal-overlay",onClick:be},[e("div",{class:"modal-content",onClick:o[10]||(o[10]=W(()=>{},["stop"]))},[e("div",{class:"modal-header"},[o[24]||(o[24]=e("h3",null,"上传图片",-1)),e("button",{onClick:be,class:"close-btn"},"✕")]),e("div",Vs,[e("div",Ps,[o[27]||(o[27]=e("label",null,"分类 (一级标签)",-1)),C(e("select",{"onUpdate:modelValue":o[3]||(o[3]=a=>v.category=a),onChange:pe,required:""},[o[25]||(o[25]=e("option",{value:""},"选择分类",-1)),(n(!0),r(X,null,R(T.value,a=>(n(),r("option",{key:a,value:a},c(a),9,Bs))),128)),o[26]||(o[26]=e("option",{value:"__other__"},"其他",-1))],544),[[N,v.category]]),v.category==="__other__"?(n(),r("div",zs,[C(e("input",{"onUpdate:modelValue":o[4]||(o[4]=a=>v.newCategoryText=a),type:"text",placeholder:"输入新分类名称",required:"",class:"form-control"},null,512),[[E,v.newCategoryText]])])):M("",!0)]),v.category?(n(),r("div",Es,[o[29]||(o[29]=e("label",null,"二级标签 (可多选)",-1)),e("div",Os,[(n(!0),r(X,null,R(Y.value,a=>(n(),r("div",{key:a,class:"tag-item"},[C(e("input",{type:"checkbox",id:`upload-tag-${a}`,value:a,"onUpdate:modelValue":o[5]||(o[5]=I=>v.tags=I)},null,8,Ns),[[Te,v.tags]]),e("label",{for:`upload-tag-${a}`},c(a),9,js)]))),128)),e("div",qs,[C(e("input",{type:"checkbox",id:"upload-other-tag","onUpdate:modelValue":o[6]||(o[6]=a=>v.otherTagEnabled=a)},null,512),[[Te,v.otherTagEnabled]]),o[28]||(o[28]=e("label",{for:"upload-other-tag"},"其他",-1)),v.otherTagEnabled?C((n(),r("input",{key:0,"onUpdate:modelValue":o[7]||(o[7]=a=>v.newTagText=a),placeholder:"新标签,逗号分隔"},null,512)),[[E,v.newTagText]]):M("",!0)])]),o[30]||(o[30]=e("p",{class:"helper-text"},"请先选择分类，然后选择相应的二级标签",-1))])):M("",!0),e("div",Xs,[o[33]||(o[33]=e("label",null,"状态",-1)),e("div",Rs,[C(e("input",{type:"radio",id:"upload-public",value:"true","onUpdate:modelValue":o[8]||(o[8]=a=>v.isPublic=a)},null,512),[[we,v.isPublic]]),o[31]||(o[31]=e("label",{for:"upload-public"},"公开",-1)),C(e("input",{type:"radio",id:"upload-private",value:"false","onUpdate:modelValue":o[9]||(o[9]=a=>v.isPublic=a)},null,512),[[we,v.isPublic]]),o[32]||(o[32]=e("label",{for:"upload-private"},"私有",-1))])]),e("div",{class:Q(["upload-area",{"drag-over":$.value}]),onClick:ve,onDrop:K,onDragover:Ue,onDragenter:ye,onDragleave:se},[e("input",{ref_key:"fileInput",ref:H,type:"file",multiple:"",accept:"image/*",onChange:Z,class:"file-input"},null,544),o[34]||(o[34]=e("div",{class:"upload-text"},[e("p",null,"拖拽图片到此处或点击选择文件"),e("p",{class:"upload-hint"},"支持多文件选择，格式：JPG、PNG、GIF等")],-1))],34),A.value.length>0?(n(),r("div",Gs,[e("h4",null,"待上传文件 ("+c(A.value.length)+")",1),e("div",Js,[(n(!0),r(X,null,R(A.value,(a,I)=>(n(),r("div",{key:I,class:"file-item"},[e("img",{src:a.preview,alt:a.name,class:"file-preview"},null,8,Qs),e("div",Ws,[e("div",Hs,c(a.name),1),e("div",Ks,c(Le(a.size)),1)]),e("button",{onClick:fe=>Ie(I),class:"remove-file"},"✕",8,Ys)]))),128))])])):M("",!0)]),e("div",Zs,[e("button",{onClick:be,class:"cancel-btn"},"取消"),e("button",{onClick:F,disabled:A.value.length===0||O.value,class:"upload-confirm-btn"},c(O.value?"上传中...":`上传 ${A.value.length} 张图片`),9,eo)])])])):M("",!0)])),(n(),oe(re,{to:"body"},[S.value?(n(),r("div",{key:0,class:"modal-overlay",onClick:_e},[e("div",{class:"modal-content",onClick:o[17]||(o[17]=W(()=>{},["stop"]))},[e("div",{class:"modal-header"},[o[35]||(o[35]=e("h3",null,"编辑图片",-1)),e("button",{onClick:_e,class:"close-btn"},"✕")]),e("div",to,[e("form",{onSubmit:W(Se,["prevent"])},[e("div",so,[o[36]||(o[36]=e("label",null,"标题",-1)),C(e("input",{"onUpdate:modelValue":o[11]||(o[11]=a=>x.title=a),type:"text",required:""},null,512),[[E,x.title]])]),e("div",oo,[o[38]||(o[38]=e("label",null,"分类",-1)),C(e("select",{"onUpdate:modelValue":o[12]||(o[12]=a=>x.category=a),required:""},[o[37]||(o[37]=e("option",{value:""},"选择分类",-1)),(n(!0),r(X,null,R(T.value,a=>(n(),r("option",{key:a,value:a},c(a),9,lo))),128))],512),[[N,x.category]])]),e("div",ao,[o[39]||(o[39]=e("label",null,"二级标签",-1)),C(e("input",{"onUpdate:modelValue":o[13]||(o[13]=a=>x.secondaryTagsInput=a),type:"text",placeholder:"用逗号分隔多个标签，如：夜景,城市,建筑"},null,512),[[E,x.secondaryTagsInput]])]),e("div",no,[o[42]||(o[42]=e("label",null,"可见性",-1)),e("div",ro,[e("label",null,[C(e("input",{type:"radio",value:!0,"onUpdate:modelValue":o[14]||(o[14]=a=>x.isPublic=a)},null,512),[[we,x.isPublic]]),o[40]||(o[40]=ne(" 公开 "))]),e("label",null,[C(e("input",{type:"radio",value:!1,"onUpdate:modelValue":o[15]||(o[15]=a=>x.isPublic=a)},null,512),[[we,x.isPublic]]),o[41]||(o[41]=ne(" 私有 "))])])]),e("div",io,[o[44]||(o[44]=e("label",null,"发布状态",-1)),C(e("select",{"onUpdate:modelValue":o[16]||(o[16]=a=>x.status=a)},o[43]||(o[43]=[e("option",{value:"draft"},"未发布",-1),e("option",{value:"published"},"已发布",-1)]),512),[[N,x.status]])]),e("div",{class:"form-actions"},[e("button",{type:"button",onClick:_e,class:"cancel-btn"},"取消"),o[45]||(o[45]=e("button",{type:"submit",class:"save-btn"},"保存",-1))])],32)])])])):M("",!0)])),(n(),oe(re,{to:"body"},[L.value?(n(),r("div",uo,[e("div",co,[o[49]||(o[49]=e("div",{class:"modal-header"},[e("h3",null,"⚠️ 确认批量删除")],-1)),e("div",po,[e("p",null,[o[46]||(o[46]=ne("您即将删除 ")),e("strong",null,c(k.value.length),1),o[47]||(o[47]=ne(" 张图片"))]),o[48]||(o[48]=e("p",{class:"warning-text"},"此操作不可撤销，确定要继续吗？",-1)),e("div",vo,[(n(!0),r(X,null,R(k.value.slice(0,6),a=>(n(),r("img",{key:a._id||a.id,src:Ce(a.thumbnail),alt:a.title,class:"preview-thumb"},null,8,go))),128)),k.value.length>6?(n(),r("div",mo," +"+c(k.value.length-6),1)):M("",!0)])]),e("div",fo,[e("button",{onClick:l,class:"cancel-btn"},"取消"),e("button",{onClick:d,disabled:D.value,class:"danger-btn"},c(D.value?"删除中...":"确认删除"),9,yo)])])])):M("",!0)]))]))}},_o=ue(bo,[["__scopeId","data-v-22fff292"]]),wo={class:"admin-document-manager"},ho={class:"manager-header"},$o={class:"filter-bar"},ko=["value"],Co={key:0,class:"loading-state"},To={key:1,class:"error-state"},xo={key:2,class:"document-list"},Do={class:"doc-icon"},Uo={class:"document-info"},Io={class:"document-meta"},Ao={class:"doc-category"},So={class:"doc-type"},Mo={class:"doc-size"},Lo={class:"doc-date"},Fo={key:0,class:"doc-tags"},Vo={class:"document-actions"},Po=["onClick"],Bo=["onClick"],zo=["onClick"],Eo={key:3,class:"empty-state"},Oo={class:"modal-header"},No={class:"modal-body"},jo={key:0,class:"form-group"},qo={key:0,class:"upload-placeholder"},Xo={key:1,class:"selected-file"},Ro={class:"file-details"},Go={class:"file-name"},Jo={class:"file-size"},Qo={class:"form-group"},Wo={class:"form-group"},Ho={class:"form-group"},Ko=["value"],Yo={key:0,class:"mt-2"},Zo={class:"form-group"},el={key:1,class:"form-group"},tl={class:"current-file-info"},sl={class:"file-size"},ol={class:"form-group"},ll={key:2,class:"upload-progress"},al={class:"progress-bar"},nl={class:"progress-text"},rl={class:"form-actions"},il=["disabled"],ul=["disabled"],dl={key:0},cl={key:1},pl={__name:"AdminDocumentManager",setup(ce){const V=b([]),U=b([]),k=b(!1),B=b(!1),S=b(null),L=b(""),A=b(""),O=b(""),D=b(!1),P=b(""),_=b(!1),w=b(0),m=ie({id:null,title:"",description:"",category:"",newCategoryText:"",secondaryTagsInput:"",secondaryTags:[],type:"",size:"",downloadUrl:"",previewUrl:"",status:"draft"}),q=b(["前端开发","游戏攻略","AI技术","音乐制作","模板资源"]),H=()=>{const d=new Set(["前端开发","游戏攻略","AI技术","音乐制作","模板资源"]);V.value.forEach(l=>{l.category&&d.add(l.category)}),q.value=Array.from(d).sort()},$=()=>{m.category!=="__other__"&&(m.newCategoryText="")},T=()=>{let d=V.value;if(L.value&&(d=d.filter(l=>l.category===L.value)),A.value&&(d=d.filter(l=>l.type===A.value)),O.value){const l=O.value.toLowerCase();d=d.filter(F=>{var g,z;return F.title.toLowerCase().includes(l)||((g=F.description)==null?void 0:g.toLowerCase().includes(l))||((z=F.secondaryTags)==null?void 0:z.some(Z=>Z.toLowerCase().includes(l)))})}U.value=d},v=d=>d.split(".").pop().toUpperCase(),x=d=>{if(d===0)return"0 Bytes";const l=1024,F=["Bytes","KB","MB","GB"],g=Math.floor(Math.log(d)/Math.log(l));return parseFloat((d/Math.pow(l,g)).toFixed(2))+" "+F[g]},J=d=>{const l=d.target.files[0];l&&Y(l)},te=d=>{const l=d.dataTransfer.files;l.length>0&&Y(l[0])},Y=d=>{if(d.size>52428800){alert("文件大小超过50MB限制，请选择较小的文件");return}const F=[".pdf",".doc",".docx",".ppt",".pptx",".xls",".xlsx",".txt",".md"],g=d.name.toLowerCase();if(!F.some(Z=>g.endsWith(Z))){alert("不支持的文件类型，请选择 PDF、Word、PowerPoint、Excel、TXT 或 Markdown 文件");return}S.value=d,m.type=v(d.name),m.size=x(d.size),m.title||(m.title=d.name.split(".")[0])},h=()=>{var d;S.value=null,m.type="",m.size="",(d=document.refs)!=null&&d.fileInput&&(document.refs.fileInput.value="")},i=async()=>{D.value=!0,P.value="";try{console.log("�� 调用 adminApi.getAllDocuments()"),console.log("🔍 当前用户token:",localStorage.getItem("token")?"存在":"不存在");const d=await G.getAllDocuments();if(d.success){const l=d.data.documents||d.data||[];V.value=l,U.value=l,console.log(" filteredDocuments 设置完成:",U.value.length),console.log(" filteredDocuments 状态分布:",U.value.reduce((F,g)=>(F[g.status]=(F[g.status]||0)+1,F),{})),H()}else throw new Error(d.message||"获取文档列表失败")}catch(d){console.error("❌ 获取文档列表失败:",d)}finally{D.value=!1}},y=d=>{var l;Object.assign(m,{id:d.id,title:d.title,description:d.description,category:d.category,newCategoryText:"",secondaryTagsInput:((l=d.secondaryTags)==null?void 0:l.join(","))||"",secondaryTags:d.secondaryTags||[],type:d.type,size:d.size,downloadUrl:d.downloadUrl,previewUrl:d.previewUrl,status:d.status}),B.value=!0},f=async()=>{try{_.value=!0,w.value=0;const d=m.category==="__other__"?m.newCategoryText.trim():m.category,l={title:m.title,description:m.description,category:d,secondaryTags:m.secondaryTagsInput.split(",").map(g=>g.trim()).filter(Boolean),type:m.type,size:m.size,status:m.status};if(console.log("📝 准备发送的文档数据:",JSON.stringify(l,null,2)),!l.title){alert("请填写文档标题");return}if(!l.category){alert("请选择文档分类");return}if(m.category==="__other__"&&!m.newCategoryText.trim()){alert("请输入新分类名称");return}if(k.value&&!S.value){alert("请选择要上传的文档文件");return}let F;if(k.value)if(console.log("🆕 创建新文档..."),S.value){const g=setInterval(()=>{w.value<90&&(w.value+=Math.random()*20)},200),z=new FormData;z.append("document",S.value),z.append("title",l.title),z.append("description",l.description),z.append("category",l.category),z.append("type",l.type),z.append("status",l.status),l.secondaryTags.length>0&&z.append("secondaryTags",JSON.stringify(l.secondaryTags)),console.log("📤 FormData内容:");for(let[Z,ve]of z.entries())console.log(`  ${Z}:`,ve);try{F=await G.uploadDocumentFile(z),w.value=100}finally{clearInterval(g)}}else F=await G.createDocument(l);else console.log("✏️ 更新文档..."),w.value=50,F=await G.updateDocument(m.id,l),w.value=100;if(console.log("📤 API响应:",F),F.success)await i(),u(),alert(k.value?"文档上传成功!":"文档更新成功!");else throw new Error(F.message||"保存失败")}catch(d){console.error("❌ 保存文档失败:",d);let l="保存失败";if(d.response){console.error("错误响应状态:",d.response.status),console.error("错误响应数据:",d.response.data);const F=d.response.data;switch(F.message&&(l+=": "+F.message),d.response.status){case 400:l="数据验证失败 - 请检查所有必填字段是否正确填写",F.errors&&(console.error("验证错误详情:",F.errors),l+=`
详细错误: `+JSON.stringify(F.errors));break;case 401:l="认证失败 - 请重新登录";break;case 403:l="权限不足 - 您没有权限执行此操作";break;case 500:l="服务器内部错误 - 请稍后重试";break}}else d.request?(console.error("请求错误:",d.request),l="网络连接失败 - 请检查网络连接"):(console.error("其他错误:",d.message),l=d.message);alert(l)}finally{_.value=!1,w.value=0}},t=async d=>{var l,F;if(confirm("确定要删除这个文档吗？"))try{(await G.deleteDocument(d)).success&&(await i(),alert("文档删除成功!"))}catch(g){console.error("删除失败:",g),alert("删除失败: "+(((F=(l=g.response)==null?void 0:l.data)==null?void 0:F.message)||g.message))}},s=async d=>{var l,F,g,z,Z,ve;try{console.log(`📥 管理员下载文档: ${d.title} (ID: ${d._id||d.id})`),console.log(`📝 文档状态: ${d.status}`),console.log("🔐 使用认证API请求文档下载...");const K=await Ne.downloadDocument(d._id||d.id);console.log("✅ 成功获取文档Blob:",K.size,"bytes");const ye=window.URL.createObjectURL(K),se=document.createElement("a");se.href=ye,se.download=`${d.title}.${((l=d.type)==null?void 0:l.toLowerCase())||"file"}`,se.style.display="none",document.body.appendChild(se),se.click(),document.body.removeChild(se),window.URL.revokeObjectURL(ye),console.log(`✅ 管理员下载完成: ${d.title}`)}catch(K){console.error("❌ 管理员下载失败:",K),console.error("📊 错误详情:",{status:(F=K.response)==null?void 0:F.status,message:(z=(g=K.response)==null?void 0:g.data)==null?void 0:z.message,error:K.message}),alert("下载失败："+(((ve=(Z=K.response)==null?void 0:Z.data)==null?void 0:ve.message)||K.message||"请稍后重试"))}},u=()=>{k.value=!1,B.value=!1,S.value=null,document.querySelector('input[type="file"]')&&(document.querySelector('input[type="file"]').value=""),Object.assign(m,{id:null,title:"",description:"",category:"",newCategoryText:"",secondaryTagsInput:"",secondaryTags:[],type:"",size:"",status:"draft"})},j=d=>({PDF:"fas fa-file-pdf",DOCX:"fas fa-file-word",PPT:"fas fa-file-powerpoint",XLSX:"fas fa-file-excel",TXT:"fas fa-file-alt"})[d]||"fas fa-file",pe=d=>{if(!d)return"未知日期";const l=new Date(d);return isNaN(l.getTime())?"未知日期":l.toLocaleDateString("zh-CN")},le=d=>({draft:"私人",published:"公开",pinned:"置顶"})[d]||"未知";return de(()=>{i()}),(d,l)=>{var F;return n(),r("div",wo,[e("div",ho,[l[13]||(l[13]=e("h2",null,"文档管理",-1)),e("button",{onClick:l[0]||(l[0]=g=>k.value=!0),class:"create-btn"}," 📄 上传文档 ")]),e("div",$o,[C(e("select",{"onUpdate:modelValue":l[1]||(l[1]=g=>L.value=g),onChange:T},[l[14]||(l[14]=e("option",{value:""},"全部分类",-1)),(n(!0),r(X,null,R(q.value,g=>(n(),r("option",{key:g,value:g},c(g),9,ko))),128))],544),[[N,L.value]]),C(e("select",{"onUpdate:modelValue":l[2]||(l[2]=g=>A.value=g),onChange:T},l[15]||(l[15]=[$e('<option value="" data-v-c298b2d9>全部类型</option><option value="PDF" data-v-c298b2d9>PDF</option><option value="DOCX" data-v-c298b2d9>DOCX</option><option value="PPT" data-v-c298b2d9>PPT</option><option value="XLSX" data-v-c298b2d9>XLSX</option><option value="TXT" data-v-c298b2d9>TXT</option><option value="MD" data-v-c298b2d9>MD</option>',7)]),544),[[N,A.value]]),C(e("input",{"onUpdate:modelValue":l[3]||(l[3]=g=>O.value=g),placeholder:"搜索文档标题或描述...",onInput:T},null,544),[[E,O.value]])]),D.value?(n(),r("div",Co,l[16]||(l[16]=[e("p",null,"正在加载文档...",-1)]))):P.value?(n(),r("div",To,[l[17]||(l[17]=e("h3",null,"加载失败",-1)),e("p",null,c(P.value),1),e("button",{onClick:i,class:"retry-btn"},"重试")])):(n(),r("div",xo,[(n(!0),r(X,null,R(U.value,g=>(n(),r("div",{key:g._id||g.id,class:"document-card"},[e("div",Do,[e("i",{class:Q(j(g.type))},null,2)]),e("div",Uo,[e("h3",null,c(g.title),1),e("p",null,c(g.description),1),e("div",Io,[e("span",Ao,c(g.category),1),e("span",So,c(g.type),1),e("span",Mo,c(g.size||g.formattedSize),1),e("span",Lo,c(pe(g.date||g.createdAt)),1),e("span",{class:Q(["status",g.status])},c(le(g.status)),3)]),g.secondaryTags&&g.secondaryTags.length?(n(),r("div",Fo,[(n(!0),r(X,null,R(g.secondaryTags,z=>(n(),r("span",{key:z,class:"tag"},c(z),1))),128))])):M("",!0)]),e("div",Vo,[e("button",{onClick:z=>y(g),class:"edit-btn"},"编辑",8,Po),e("button",{onClick:z=>t(g._id||g.id),class:"delete-btn"},"删除",8,Bo),e("button",{onClick:z=>s(g),class:"download-btn"},"下载",8,zo)])]))),128))])),!D.value&&!P.value&&U.value.length===0?(n(),r("div",Eo,l[18]||(l[18]=[e("h3",null,"暂无文档",-1),e("p",null,"还没有上传任何文档，点击创建按钮开始添加文档",-1)]))):M("",!0),(n(),oe(re,{to:"body"},[k.value||B.value?(n(),r("div",{key:0,class:"modal-overlay",onClick:u},[e("div",{class:"modal-content",onClick:l[12]||(l[12]=W(()=>{},["stop"]))},[e("div",Oo,[e("h3",null,c(k.value?"上传文档":"编辑文档"),1),e("button",{onClick:u,class:"close-btn"},"✕")]),e("div",No,[e("form",{onSubmit:W(f,["prevent"])},[k.value?(n(),r("div",jo,[l[20]||(l[20]=e("label",null,"📁 选择文档文件",-1)),e("div",{class:"file-upload-area",onClick:l[4]||(l[4]=g=>{var z;return(z=d.$refs.fileInput)==null?void 0:z.click()}),onDragover:l[5]||(l[5]=W(()=>{},["prevent"])),onDrop:W(te,["prevent"])},[e("input",{ref:"fileInput",type:"file",onChange:J,accept:".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.txt,.md",style:{display:"none"}},null,544),S.value?(n(),r("div",Xo,[e("i",{class:Q([j(v(S.value.name)),"file-icon"])},null,2),e("div",Ro,[e("span",Go,c(S.value.name),1),e("span",Jo,c(x(S.value.size)),1)]),e("button",{type:"button",onClick:W(h,["stop"]),class:"remove-file-btn"},"✕")])):(n(),r("div",qo,l[19]||(l[19]=[e("i",{class:"fas fa-cloud-upload-alt upload-icon"},null,-1),e("p",null,"点击选择文件或拖拽文件到此处",-1),e("p",{class:"upload-hint"},"支持 PDF、Word、PowerPoint、Excel、TXT、Markdown 文件",-1),e("p",{class:"size-limit"},"文件大小限制：50MB",-1)])))],32)])):M("",!0),e("div",Qo,[l[21]||(l[21]=e("label",null,"标题",-1)),C(e("input",{"onUpdate:modelValue":l[6]||(l[6]=g=>m.title=g),type:"text",required:""},null,512),[[E,m.title]])]),e("div",Wo,[l[22]||(l[22]=e("label",null,"描述",-1)),C(e("textarea",{"onUpdate:modelValue":l[7]||(l[7]=g=>m.description=g),rows:"3"},null,512),[[E,m.description]])]),e("div",Ho,[l[25]||(l[25]=e("label",null,"分类",-1)),C(e("select",{"onUpdate:modelValue":l[8]||(l[8]=g=>m.category=g),onChange:$,required:""},[l[23]||(l[23]=e("option",{value:""},"选择分类",-1)),(n(!0),r(X,null,R(q.value,g=>(n(),r("option",{key:g,value:g},c(g),9,Ko))),128)),l[24]||(l[24]=e("option",{value:"__other__"},"其他",-1))],544),[[N,m.category]]),m.category==="__other__"?(n(),r("div",Yo,[C(e("input",{"onUpdate:modelValue":l[9]||(l[9]=g=>m.newCategoryText=g),type:"text",placeholder:"输入新分类名称",required:"",class:"form-control"},null,512),[[E,m.newCategoryText]])])):M("",!0)]),e("div",Zo,[l[26]||(l[26]=e("label",null,"二级标签",-1)),C(e("input",{"onUpdate:modelValue":l[10]||(l[10]=g=>m.secondaryTagsInput=g),type:"text",placeholder:"用逗号分隔多个标签，如：Vue3,JavaScript,Composition API"},null,512),[[E,m.secondaryTagsInput]])]),B.value?(n(),r("div",el,[l[27]||(l[27]=e("label",null,"当前文件",-1)),e("div",tl,[e("i",{class:Q(j(m.type))},null,2),e("span",null,c(m.title)+"."+c((F=m.type)==null?void 0:F.toLowerCase()),1),e("span",sl,"("+c(m.size)+")",1)]),l[28]||(l[28]=e("p",{class:"file-note"},"💡 提示：要更换文件请重新上传",-1))])):M("",!0),e("div",ol,[l[30]||(l[30]=e("label",null,"状态",-1)),C(e("select",{"onUpdate:modelValue":l[11]||(l[11]=g=>m.status=g)},l[29]||(l[29]=[e("option",{value:"draft"},"私人",-1),e("option",{value:"published"},"公开",-1),e("option",{value:"pinned"},"置顶",-1)]),512),[[N,m.status]])]),_.value?(n(),r("div",ll,[e("div",al,[e("div",{class:"progress-fill",style:ze({width:w.value+"%"})},null,4)]),e("p",nl,c(k.value?"正在上传文档...":"正在保存...")+" "+c(w.value)+"%",1)])):M("",!0),e("div",rl,[e("button",{type:"button",onClick:u,disabled:_.value,class:"cancel-btn"},"取消",8,il),e("button",{type:"submit",disabled:_.value,class:"save-btn"},[_.value?(n(),r("span",dl,[l[31]||(l[31]=e("i",{class:"fas fa-spinner fa-spin"},null,-1)),ne(" "+c(k.value?"上传中...":"保存中..."),1)])):(n(),r("span",cl,c(k.value?"📁 上传文档":"💾 保存"),1))],8,ul)])],32)])])])):M("",!0)]))])}}},vl=ue(pl,[["__scopeId","data-v-c298b2d9"]]),gl={class:"admin-comment-manager"},ml={class:"manager-header"},fl={class:"stats"},yl={class:"total-count"},bl={class:"filter-bar"},_l={key:0,class:"loading-state"},wl={key:1,class:"error-state"},hl={key:2,class:"comment-list"},$l={class:"comment-info"},kl={class:"comment-header"},Cl={class:"user-info"},Tl={class:"commenter"},xl={class:"comment-source"},Dl=["onClick","title"],Ul={class:"comment-meta"},Il={class:"comment-time"},Al={key:0,class:"reply-indicator"},Sl={class:"comment-content"},Ml={key:0,class:"parent-comment"},Ll={class:"parent-content"},Fl={class:"comment-actions"},Vl={class:"like-count"},Pl=["onClick"],Bl=["onClick"],zl=["onClick"],El={key:3,class:"empty-state"},Ol={__name:"AdminCommentReview",setup(ce){const V=xe(),U=b([]),k=b(""),B=b(""),S=b(""),L=b(!1),A=b(""),O=ee(()=>U.value.length),D=async()=>{L.value=!0,A.value="";try{const $={};k.value&&($.status=k.value),B.value&&($.targetType=B.value),S.value&&($.search=S.value);const T=await G.getAllComments($);if(T.success)U.value=T.data.comments||T.data||[];else throw new Error(T.message||"获取评论列表失败")}catch($){console.error("获取评论列表失败:",$),A.value=$.message||"获取评论列表失败，请稍后重试",U.value=[]}finally{L.value=!1}},P=async $=>{var T,v;if(confirm("确定要删除这条评论吗？此操作不可恢复。"))try{(await G.deleteComment($)).success&&(await D(),alert("评论已删除!"))}catch(x){console.error("删除失败:",x),alert("删除失败: "+(((v=(T=x.response)==null?void 0:T.data)==null?void 0:v.message)||x.message))}},_=async $=>{var T,v;try{const x=!$.isPublic;(await G.updateCommentVisibility($._id||$.id,x)).success&&($.isPublic=x,alert(`评论已${x?"设为公开":"设为私有"}`))}catch(x){console.error("更新可见性失败:",x),alert("操作失败: "+(((v=(T=x.response)==null?void 0:T.data)==null?void 0:v.message)||x.message))}},w=$=>{if(console.log("跳转评论来源:",$),$.targetType==="blog"||$.targetType==="Blog")if($.targetId){const T=typeof $.targetId=="object"?$.targetId._id:$.targetId;V.push(`/blog/${T}`)}else alert("博客ID缺失，无法跳转");else $.targetType==="comment"?V.push("/comments"):$.targetType==="document"||$.targetType==="Document"?$.targetTitle?V.push({path:"/documents",query:{search:$.targetTitle}}):V.push("/documents"):$.targetType==="General"?V.push("/comments"):$.targetType==="gallery"||$.targetType==="Gallery"?V.push("/gallery"):(console.warn("未知的目标类型:",$.targetType,$),alert("无法确定跳转目标，可能是数据不完整"))},m=$=>({blog:"博客",Blog:"博客",comment:"评论区",General:"留言板"})[$]||"其他",q=$=>{const T=m($.targetType),v=$.targetTitle||"";return $.targetType==="blog"||$.targetType==="Blog"?v?`博客：${v}`:"博客":$.targetType==="General"?"留言板":v?`${T}：${v}`:T},H=$=>{if(!$)return"未知时间";const T=new Date($);return isNaN(T.getTime())?"未知时间":T.toLocaleString("zh-CN")};return de(()=>{D()}),($,T)=>(n(),r("div",gl,[e("div",ml,[T[2]||(T[2]=e("h2",null,"评论管理",-1)),e("div",fl,[e("span",yl,"总评论: "+c(O.value),1)])]),e("div",bl,[C(e("select",{"onUpdate:modelValue":T[0]||(T[0]=v=>B.value=v),onChange:D},T[3]||(T[3]=[e("option",{value:""},"全部来源",-1),e("option",{value:"blog"},"博客",-1),e("option",{value:"comment"},"评论区",-1),e("option",{value:"General"},"留言板",-1)]),544),[[N,B.value]]),C(e("input",{"onUpdate:modelValue":T[1]||(T[1]=v=>S.value=v),placeholder:"搜索评论内容或用户...",onInput:D},null,544),[[E,S.value]])]),L.value?(n(),r("div",_l,T[4]||(T[4]=[e("p",null,"正在加载评论...",-1)]))):A.value?(n(),r("div",wl,[T[5]||(T[5]=e("h3",null,"加载失败",-1)),e("p",null,c(A.value),1),e("button",{onClick:D,class:"retry-btn"},"重试")])):(n(),r("div",hl,[(n(!0),r(X,null,R(U.value,v=>{var x;return n(),r("div",{key:v._id||v.id,class:"comment-card"},[e("div",$l,[e("div",kl,[e("div",Cl,[e("span",Tl,c(((x=v.author)==null?void 0:x.username)||v.author||"匿名用户"),1)]),e("div",xl,[T[6]||(T[6]=e("span",{class:"source-label"},"来源:",-1)),e("button",{onClick:J=>w(v),class:"source-link",title:`点击跳转到${q(v)}`},c(q(v)),9,Dl)])]),e("div",Ul,[e("span",Il,c(H(v.createdAt)),1),v.parentComment?(n(),r("span",Al,"回复评论")):M("",!0)]),e("div",Sl,c(v.content),1),v.parentComment?(n(),r("div",Ml,[T[7]||(T[7]=e("span",{class:"parent-label"},"回复:",-1)),e("span",Ll,c(v.parentComment.content),1)])):M("",!0)]),e("div",Fl,[e("span",Vl,c(v.likeCount||0)+" ❤️",1),e("button",{onClick:J=>_(v),class:Q(["visibility-btn",{private:!v.isPublic}])},c(v.isPublic?"🔒 设为私有":"🔓 设为公开"),11,Pl),e("button",{onClick:J=>w(v),class:"jump-btn"}," 🔗 跳转 ",8,Bl),e("button",{onClick:J=>P(v._id||v.id),class:"delete-btn"}," 🗑️ 删除 ",8,zl)])])}),128))])),!L.value&&!A.value&&U.value.length===0?(n(),r("div",El,T[8]||(T[8]=[e("h3",null,"暂无评论",-1),e("p",null,"还没有任何评论数据",-1)]))):M("",!0)]))}},Nl=ue(Ol,[["__scopeId","data-v-b69f155c"]]),jl={class:"admin-user-manager"},ql={class:"filter-bar"},Xl={key:0,class:"loading-state"},Rl={key:1,class:"error-state"},Gl={key:2,class:"users-table"},Jl={class:"user-info"},Ql={class:"username"},Wl={key:0,class:"pending-dot"},Hl={class:"user-id"},Kl={class:"action-buttons"},Yl=["onClick"],Zl=["onClick"],ea=["onClick"],ta={key:3,class:"empty-state"},sa={class:"modal-body"},oa={class:"form-group"},la={class:"form-group"},aa={class:"form-group"},na={class:"password-input-group"},ra={class:"form-group"},ia={class:"form-group"},ua={__name:"AdminUserManager",setup(ce){const V=b([]),U=b([]),k=b(!1),B=b(!1),S=b(""),L=b(""),A=b(""),O=b(""),D=ie({id:null,username:"",email:"",password:"",role:"user",status:"pending"}),P=ee(()=>{const{user:h}=De.getAuth();return(h==null?void 0:h._id)||(h==null?void 0:h.id)}),_=ee(()=>[...U.value].sort((h,i)=>h.status==="pending"&&i.status!=="pending"?-1:h.status!=="pending"&&i.status==="pending"?1:new Date(i.createdAt||0)-new Date(h.createdAt||0))),w=async()=>{B.value=!0,S.value="";try{const h=await G.getAllUsers();if(h.success){const i=(h.data.users||h.data||[]).map(y=>({...y,status:y.status||(y.active!==!1?"approved":"pending")}));V.value=i,U.value=i}else throw new Error(h.message||"获取用户列表失败")}catch(h){console.error("❌ 获取用户列表失败:",h),S.value=h.message||"获取用户列表失败，请稍后重试";const i=[{_id:"1",username:"admin",email:"admin@example.com",role:"admin",status:"approved",createdAt:new Date().toISOString()},{_id:"2",username:"newuser",email:"newuser@example.com",role:"user",status:"pending",createdAt:new Date(Date.now()-864e5).toISOString()},{_id:"3",username:"alice",email:"alice@example.com",role:"user",status:"approved",createdAt:new Date(Date.now()-1728e5).toISOString()}];V.value=i,U.value=i}finally{B.value=!1}},m=()=>{let h=V.value;if(L.value&&(h=h.filter(i=>i.role===L.value)),A.value&&(h=h.filter(i=>i.status===A.value)),O.value){const i=O.value.toLowerCase();h=h.filter(y=>y.username.toLowerCase().includes(i)||y.email.toLowerCase().includes(i))}U.value=h},q=h=>{Object.assign(D,{id:h._id||h.id,username:h.username,email:h.email,password:"",role:h.role,status:h.status}),k.value=!0},H=()=>{confirm("确定要重置此用户的密码为 123456 吗？")&&(D.password="123456",alert("密码已设置为 123456"))},$=async h=>{var i,y;if(confirm("确定要启用此用户吗？"))try{(await G.updateUserRole(h,{status:"approved"})).success&&(await w(),alert("用户已启用!"))}catch(f){console.error("启用失败:",f),alert("启用失败: "+(((y=(i=f.response)==null?void 0:i.data)==null?void 0:y.message)||f.message))}},T=async()=>{var h,i;try{const y={username:D.username,email:D.email,role:D.role,status:D.status};D.password&&(y.password=D.password),(await G.updateUserRole(D.id,y)).success&&(alert("用户更新成功!"),await w(),x())}catch(y){console.error("保存失败:",y),alert("保存失败: "+(((i=(h=y.response)==null?void 0:h.data)==null?void 0:i.message)||y.message))}},v=async h=>{var i,y;if(confirm("确定要删除此用户吗？此操作将删除该用户的所有博客、评论等数据，不可恢复！"))try{(await G.deleteUser(h)).success&&(await w(),alert("用户删除成功!"))}catch(f){console.error("删除失败:",f),alert("删除失败: "+(((y=(i=f.response)==null?void 0:i.data)==null?void 0:y.message)||f.message))}},x=()=>{k.value=!1,Object.assign(D,{id:null,username:"",email:"",password:"",role:"user",status:"pending"})},J=h=>{if(!h)return"";const i=new Date(h);return isNaN(i.getTime())?"":i.toLocaleString("zh-CN")},te=h=>({admin:"管理员",user:"普通用户"})[h]||h,Y=h=>({approved:"已启用",pending:"待审核"})[h]||h;return de(()=>{w()}),(h,i)=>(n(),r("div",jl,[i[24]||(i[24]=e("div",{class:"manager-header"},[e("h2",null,"用户管理")],-1)),e("div",ql,[C(e("select",{"onUpdate:modelValue":i[0]||(i[0]=y=>L.value=y),onChange:m},i[9]||(i[9]=[e("option",{value:""},"全部角色",-1),e("option",{value:"admin"},"管理员",-1),e("option",{value:"user"},"普通用户",-1)]),544),[[N,L.value]]),C(e("select",{"onUpdate:modelValue":i[1]||(i[1]=y=>A.value=y),onChange:m},i[10]||(i[10]=[e("option",{value:""},"全部状态",-1),e("option",{value:"approved"},"已启用",-1),e("option",{value:"pending"},"待审核",-1)]),544),[[N,A.value]]),C(e("input",{"onUpdate:modelValue":i[2]||(i[2]=y=>O.value=y),placeholder:"搜索用户名或邮箱...",onInput:m},null,544),[[E,O.value]])]),B.value?(n(),r("div",Xl,i[11]||(i[11]=[e("p",null,"正在加载用户数据...",-1)]))):S.value?(n(),r("div",Rl,[i[12]||(i[12]=e("h3",null,"加载失败",-1)),e("p",null,c(S.value),1),e("button",{onClick:w,class:"retry-btn"},"重试")])):(n(),r("div",Gl,[e("table",null,[i[13]||(i[13]=e("thead",null,[e("tr",null,[e("th",null,"用户名"),e("th",null,"邮箱"),e("th",null,"角色"),e("th",null,"状态"),e("th",null,"注册时间"),e("th",null,"操作")])],-1)),e("tbody",null,[(n(!0),r(X,null,R(_.value,y=>(n(),r("tr",{key:y._id||y.id,class:Q({"pending-user":y.status==="pending"})},[e("td",null,[e("div",Jl,[e("div",Ql,[y.status==="pending"?(n(),r("span",Wl)):M("",!0),ne(" "+c(y.username),1)]),e("div",Hl,"ID: "+c(y._id||y.id),1)])]),e("td",null,c(y.email),1),e("td",null,[e("span",{class:Q(["role-badge",y.role])},c(te(y.role)),3)]),e("td",null,[e("span",{class:Q(["status-badge",y.status])},c(Y(y.status)),3)]),e("td",null,c(J(y.createdAt||y.registerTime)),1),e("td",null,[e("div",Kl,[e("button",{onClick:f=>q(y),class:"edit-btn"},"编辑",8,Yl),y.status==="pending"?(n(),r("button",{key:0,onClick:f=>$(y._id||y.id),class:"approve-btn"}," 启用 ",8,Zl)):M("",!0),y.role!=="admin"||y._id!==P.value?(n(),r("button",{key:1,onClick:f=>v(y._id||y.id),class:"delete-btn"}," 删除 ",8,ea)):M("",!0)])])],2))),128))])])])),!B.value&&!S.value&&U.value.length===0?(n(),r("div",ta,i[14]||(i[14]=[e("h3",null,"暂无用户数据",-1),e("p",null,"没有找到符合条件的用户",-1)]))):M("",!0),(n(),oe(re,{to:"body"},[k.value?(n(),r("div",{key:0,class:"modal-overlay",onClick:x},[e("div",{class:"modal-content",onClick:i[8]||(i[8]=W(()=>{},["stop"]))},[e("div",{class:"modal-header"},[i[15]||(i[15]=e("h3",null,"编辑用户",-1)),e("button",{onClick:x,class:"close-btn"},"✕")]),e("div",sa,[e("form",{onSubmit:W(T,["prevent"])},[e("div",oa,[i[16]||(i[16]=e("label",null,"用户名",-1)),C(e("input",{"onUpdate:modelValue":i[3]||(i[3]=y=>D.username=y),type:"text",required:""},null,512),[[E,D.username]])]),e("div",la,[i[17]||(i[17]=e("label",null,"邮箱",-1)),C(e("input",{"onUpdate:modelValue":i[4]||(i[4]=y=>D.email=y),type:"email",required:""},null,512),[[E,D.email]])]),e("div",aa,[i[18]||(i[18]=e("label",null,"密码",-1)),e("div",na,[C(e("input",{"onUpdate:modelValue":i[5]||(i[5]=y=>D.password=y),type:"password",placeholder:"留空则不修改密码"},null,512),[[E,D.password]]),e("button",{type:"button",onClick:H,class:"reset-password-btn"},"重置密码")])]),e("div",ra,[i[20]||(i[20]=e("label",null,"角色",-1)),C(e("select",{"onUpdate:modelValue":i[6]||(i[6]=y=>D.role=y),required:""},i[19]||(i[19]=[e("option",{value:"user"},"普通用户",-1),e("option",{value:"admin"},"管理员",-1)]),512),[[N,D.role]])]),e("div",ia,[i[22]||(i[22]=e("label",null,"状态",-1)),C(e("select",{"onUpdate:modelValue":i[7]||(i[7]=y=>D.status=y)},i[21]||(i[21]=[e("option",{value:"pending"},"待审核",-1),e("option",{value:"approved"},"已启用",-1)]),512),[[N,D.status]])]),e("div",{class:"form-actions"},[e("button",{type:"button",onClick:x,class:"cancel-btn"},"取消"),i[23]||(i[23]=e("button",{type:"submit",class:"save-btn"},"更新",-1))])],32)])])])):M("",!0)]))]))}},da=ue(ua,[["__scopeId","data-v-c46a3f58"]]),ca={class:"admin-panel"},pa={class:"admin-header"},va={class:"welcome-section"},ga={class:"welcome-text"},ma={class:"admin-nav"},fa={class:"nav-grid"},ya=["onClick"],ba={class:"nav-icon"},_a={key:0,class:"pending-badge"},wa={class:"admin-content"},ha={key:0,class:"overview-content"},$a={class:"recent-activities"},ka={key:0,class:"activity-list"},Ca={class:"activity-icon"},Ta={class:"activity-content"},xa={class:"activity-text"},Da={class:"activity-time"},Ua={key:1,class:"empty-activity"},Ia={__name:"AdminPanel",setup(ce){xe();const V=b("overview"),U=b(null),k=ie({blogs:0,images:0,documents:0,comments:0}),B=b([]),S=ee(()=>[{key:"blogs",icon:"📝",label:"博客管理",description:"创建和编辑博客文章",pending:0},{key:"gallery",icon:"🖼️",label:"图库管理",description:"管理图片和分类",pending:0},{key:"documents",icon:"📄",label:"文档管理",description:"管理文档和资源",pending:0},{key:"friend-links",icon:"🔗",label:"友情链接",description:"管理友情链接申请",pending:0},{key:"users",icon:"👥",label:"用户管理",description:"管理用户账户和权限",pending:0},{key:"comments",icon:"💬",label:"评论管理",description:"管理用户评论",pending:0},{key:"user-panel",icon:"👤",label:"我的面板",description:"管理个人评论和设置",pending:0}]),L=ee(()=>({blogs:_t,gallery:_o,documents:vl,"friend-links":rs,users:da,comments:Nl,"user-panel":je})[V.value]),A=()=>{const{user:P}=De.getAuth();U.value=P},O=async()=>{try{const P=await G.getStats();P.success&&(Object.assign(k,P.data.stats),B.value=(P.data.recentActivities||[]).slice(0,3))}catch(P){console.error("获取统计数据失败:",P),Object.assign(k,{blogs:15,images:128,documents:25,playlists:45,comments:89}),B.value=[{id:1,icon:"🚀",text:"系统启动完成",time:new Date},{id:2,icon:"👨‍💼",text:"管理员登录成功",time:new Date(Date.now()-1e3*60*10)},{id:3,icon:"🔗",text:"数据库连接正常",time:new Date(Date.now()-1e3*60*30)}]}},D=P=>new Date(P).toLocaleString("zh-CN");return de(()=>{A(),O()}),(P,_)=>{var w;return n(),r("div",ca,[e("div",pa,[e("div",va,[_[0]||(_[0]=e("h1",null,"管理员控制台",-1)),e("p",ga,"欢迎回来，"+c((w=U.value)==null?void 0:w.username)+"！",1)])]),e("div",ma,[e("div",fa,[(n(!0),r(X,null,R(S.value,m=>(n(),r("div",{key:m.key,class:Q(["nav-card",{active:V.value===m.key}]),onClick:q=>V.value=m.key},[e("div",ba,c(m.icon),1),e("h3",null,c(m.label),1),e("p",null,c(m.description),1),m.pending>0?(n(),r("div",_a,c(m.pending),1)):M("",!0)],10,ya))),128))])]),e("div",wa,[V.value==="overview"?(n(),r("div",ha,[_[3]||(_[3]=e("h2",null,"系统总览",-1)),e("div",$a,[_[2]||(_[2]=e("h3",null,"最近活动",-1)),B.value.length>0?(n(),r("div",ka,[(n(!0),r(X,null,R(B.value.slice(0,3),m=>(n(),r("div",{key:m.id,class:"activity-item"},[e("div",Ca,c(m.icon),1),e("div",Ta,[e("div",xa,c(m.text),1),e("div",Da,c(D(m.time)),1)])]))),128))])):(n(),r("div",Ua,_[1]||(_[1]=[e("p",null,"暂无最近活动",-1)])))])])):M("",!0),V.value!=="overview"?(n(),oe(Ee(L.value),{key:1})):M("",!0)])])}}},Oa=ue(Ia,[["__scopeId","data-v-c7cec6c9"]]);export{Oa as default};
